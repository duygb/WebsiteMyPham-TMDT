function _CPA(e){var t=this;document.location.host.split(".");t._domain=document.location.host,0<=t._domain.indexOf("vccloud.vn")&&(t._domain=".vccloud.vn"),t.getItemId(document.location.pathname),void 0===(e=void 0===e?{}:e).rtg_id&&(e.rtg_id=0),t.cpabd_param=e,t.cpabd_logged=!1}window.ADS_CPA_CHECKER={cpa:!0,cookies:{tid:"__tid",tp:"__tpn",iid:"__iid",src:"__src",su:"__su",st:"__st",v:"__v",sv:"__sv",domain:"__d",utm:"__utm"}},window.ADS_CPA_DOMAIN_DEFAULT="lg1.logging.admicro.vn",window.ADS_CPA_DOMAINS={"lg1.logging.admicro.vn":"contineljs.com"},_CPA.prototype.getRandom=function(){return Math.floor(1e3*Math.random()+1)},_CPA.prototype.isFirefox=function(){return 0<=window.navigator.userAgent.indexOf("Firefox")},_CPA.prototype.getItemId=function(e){var t=this,o=null;if(null==e||"/"==e)return o;switch(t._domain){case"www.lazada.vn":document.getElementById("pdtsku")&&(o=(o=document.getElementById("pdtsku").innerHTML).replace(/[\r\n]+/g,""))}return null!=o&&""!=o&&t.setCookie(window.ADS_CPA_CHECKER.cookies.v,o,30,t._domain),o},_CPA.prototype.parseUTMCookie=function(){var e={},t=this.getCookie("__utm");if(t){var o=t.split("|");for(i=0;i<o.length;i++){var a=o[i].split("=");e[a[0]]=a[1]}}return{source:void 0!==e.source?e.source:"",medium:void 0!==e.medium?e.medium:"",campaign:void 0!==e.campaign?e.campaign:"",content:void 0!==e.content?e.content:""}},_CPA.prototype.setValue=function(e,t){var o=this;return o.cpabd_param.v=e+"###"+t,o.setCookie(window.ADS_CPA_CHECKER.cookies.v,o.cpabd_param.v,30,o._domain),o},_CPA.prototype.getUId=function(){var e="-1";try{e=ADM_AdsTracking.get("__uid")}catch(e){}return e},_CPA.prototype.getUIdDomain=function(){var e=-1;try{e=void 0!==(e=localStorage.__uidac)?e:-1}catch(e){}return e},_CPA.prototype.init=function(){var e,t,o=this,i=o.cpabd_param,a=o.getParam("cpa_tid"),n=o.getCookie("__tid"),d="",c=o.getCookie("__iid");if("undefined"==n&&(n="",o.setCookie("__tid","",30,o._domain)),""!=a&&(n=a,o.setCookie("__tid",a,30,o._domain),""!=(e=0<(e=parseInt(o.getParam("tpn")))?-1:e)&&o.setCookie("__tpn",e,30,o._domain),""!=(t=o.getParam("ma"))&&null!=t&&o.setCookie("__ma",t,30,o._domain)),(d={query:{source:o.getParam("utm_source"),medium:o.getParam("utm_medium"),campaign:o.getParam("utm_campaign"),content:o.getParam("utm_content")},cookie:this.parseUTMCookie()}).query.source!=d.cookie.source||d.query.medium!=d.cookie.medium||d.query.campaign!=d.cookie.campaign||d.query.content!=d.cookie.content){var r="";for(var _ in d.query)d.query[_]&&(r+=""!=r?"|":"",r+=_+"="+encodeURIComponent(d.query[_]));r&&o.setCookie(window.ADS_CPA_CHECKER.cookies.utm,r,30,o._domain)}var s=0,s="undefined"!=typeof _CPA_CONVERSION_PAGE?_CPA_CONVERSION_PAGE:s;i.tid=n,i.s=void 0!==i.s?i.s:s,i.iid=void 0!==i.iid?i.iid:c,"undefined"!=c&&""!=c||o.setCookie("__iid",i.iid,30,o._domain);i.st=void 0!==i.st?i.st:-1,o.cpabd_param=i},_CPA.prototype.getDomainReferer=function(){var e=this,t=e.getParam("dmn");return""!=t?e.setCookie("__d",t,30,e._domain):t=e.getCookie("__d"),""!=t?t:-1},_CPA.prototype.getParam=function(e){var t="";return(e=new RegExp("[?&]"+encodeURIComponent(e)+"=([^&]*)").exec(location.search))&&(t=decodeURIComponent(e[1])),t},_CPA.prototype.getCookie=function(e){return 0<document.cookie.length&&(c_start=document.cookie.indexOf(e+"="),-1!=c_start)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""},_CPA.prototype.setCookie=function(e,t,o,i){var a=new Date,n=document.location.protocol;switch(a.setDate(a.getDate()+o),n){case"https:":document.cookie=e+"="+escape(t)+(null==o?"":";path=/;domain="+i+";expires="+a.toUTCString()+";secure;SameSite=None"),document.cookie=e+"="+escape(t)+(null==o?"":";path=/;expires="+a.toUTCString()+";secure;SameSite=None");break;case"http:":default:document.cookie=e+"="+escape(t)+(null==o?"":";path=/;domain="+i+";expires="+a.toUTCString()+";SameSite=Strict"),document.cookie=e+"="+escape(t)+(null==o?"":";path=/;expires="+a.toUTCString()+";SameSite=Strict")}},_CPA.prototype.isMobile=function(){var e=window.ADS_CPA_CHECKER.cookies.src;return"MOB"==this.getCookie(e)},_CPA.prototype.getType=function(){var e=parseInt(this.getCookie("__tpn")),t=-1;switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:t=e}return t},_CPA.prototype.getProductType=function(){var e=parseInt(this.getCookie("__tpn"));return 0<e?e:-1},_CPA.prototype.send=function(e){this.isFirefox()&&(e=e.replace(window.ADS_CPA_DOMAIN_DEFAULT,window.ADS_CPA_DOMAINS[window.ADS_CPA_DOMAIN_DEFAULT]));var t=this,o=new Image;o.src=e,o.onerror=function(){e=e.replace(window.ADS_CPA_DOMAIN_DEFAULT,window.ADS_CPA_DOMAINS[window.ADS_CPA_DOMAIN_DEFAULT]),t.send(e)}},_CPA.prototype.start=function(e){var t=this,o=t.cpabd_param,e=void 0===e||1==e?1:0,i="",a=window.ADS_CPA_DOMAIN_DEFAULT,n=this.parseUTMCookie();void 0!==o.iid&&null!=o.iid&&(i=o.iid),""!=i&&t.setCookie("__iid",o.iid,30,t._domain);var d=new RegExp("^[0-9a-zA-Z-]+$");if(""!=o.tid&&0==d.test(o.tid))return!1;o.tid=""==o.tid?"-1":o.tid;var c=document.location.href;c=(c=c.replace("&cpa_tid="+o.tid,"")).replace("cpa_tid="+o.tid,"");var r="";for(var _ in n)""!=n[_]&&(r+=r?"&":"",r+="utm_"+_+"="+n[_]);r&&(c=c.replace(/([&]*)utm_[source|medium|campaign|content]+=[^&]+/gim,""),c+=0<=c.indexOf("?")?"&":"?",c+=r);var s="https://"+a+"/cpa2"+"?tid="+o.tid+"&path="+encodeURIComponent(c);1==t.getCookie(window.ADS_CPA_CHECKER.cookies.su)&&(o.s=1),void 0!==o.s&&0<=o.s&&(s+="&success="+encodeURIComponent(o.s),t.setCookie(window.ADS_CPA_CHECKER.cookies.su,o.s,30,t._domain));var p=t.getCookie(window.ADS_CPA_CHECKER.cookies.v);""!=p&&null!=p&&(o.value=p),void 0!==o.value&&null!=o.value&&null!=i&&(i+="@@@"+o.value.replace(/\t/g," ")),""!=i&&(s+="&iid="+encodeURIComponent(i)),s+="&src="+t.getType(),s+="&ng="+t.getUId(),s+="&sdmn="+t.getDomainReferer(),s+="&dg="+t.getUIdDomain(),1==e&&(1==o.s&&t.setCookie(window.ADS_CPA_CHECKER.cookies.su,"",-30,t._domain),1==o.s&&t.setCookie(window.ADS_CPA_CHECKER.cookies.v,"",-30,t._domain),t.send(s)),1==e&&t.retargetingCreate(o.iid,o.rtg_id,o.value)},_CPA.prototype.setStepValue=function(e){var t=this;return t.cpabd_param.step_value=e,t.setCookie(window.ADS_CPA_CHECKER.cookies.sv,t.cpabd_param.step_value,30,t._domain),t},_CPA.prototype.step=function(e){var t=this,o=t.cpabd_param,e=void 0===e||1==e?1:0,i=t.getCookie(window.ADS_CPA_CHECKER.cookies.st),a=window.ADS_CPA_DOMAIN_DEFAULT,n=this.parseUTMCookie();if(o.st=0<i&&""!=i?i:o.st,0==e)0<(i=void 0!==o.st?o.st:-1)&&t.setCookie(window.ADS_CPA_CHECKER.cookies.st,i,30,t._domain),void 0!==o.step_value&&""!=o.step_value&&t.setCookie(window.ADS_CPA_CHECKER.cookies.sv,o.step_value,30,t._domain);else if(1==e&&0<o.st){new RegExp("^[0-9a-zA-Z-]+$");o.tid=""==o.tid?"-1":o.tid;var d=document.location.href,c="";d=(d=d.replace("&cpa_tid="+o.tid,"")).replace("cpa_tid="+o.tid,"");var r="";for(var _ in n)""!=n[_]&&(r+=r?"&":"",r+="utm_"+_+"="+n[_]);r&&(d=d.replace(/([&]*)utm_[source|medium|campaign|content]+=[^&]+/gim,""),d+=0<=d.indexOf("?")?"&":"?",d+=r);var s="https://"+a+"/cpa2"+"?tid="+o.tid+"&path="+encodeURIComponent(d)+"&success=2";void 0!==o.iid&&null!=o.iid&&(c=o.iid);var p=t.getCookie(window.ADS_CPA_CHECKER.cookies.sv);""!=p&&null!=p&&(o.step_value=p),void 0!==o.step_value&&null!=o.step_value&&null!=c&&(c+="@@@"+o.step_value.replace(/\t/g," ")),""!=c&&(s+="&iid="+encodeURIComponent(c)),s+="&src="+t.getType(),s+="&sdmn="+t.getDomainReferer(),s+="&dg="+t.getUIdDomain(),s+="&st="+o.st,t.send(s),0<i&&t.setCookie(window.ADS_CPA_CHECKER.cookies.st,"",-30,t._domain),t.setCookie(window.ADS_CPA_CHECKER.cookies.sv,"",-30,t._domain)}},_CPA.prototype.cleanURL=function(e){return e.replace(/[?&]+([^=&]*)[=]*([^&]*)/gi,"")},_CPA.prototype.retargetingCreate=function(e,t,o){if(void 0===e||""==e)return!1;var i=void 0===t?0:parseInt(t),a={url:encodeURIComponent(document.location.href),ref:encodeURIComponent(document.referrer),iid:encodeURIComponent(e),tp:encodeURIComponent(this.getProductType()),rtg_id:i,value:void 0!==o&&""!=o?o:-1,ui:this.getUId(),ce:1},n="https://"+window.ADS_CPA_DOMAIN_DEFAULT+"/rtg_bn?url="+a.url+"&rf="+a.ref+"&a="+a.iid+"&b="+a.tp+"&c="+a.rtg_id+"&d="+a.value+"&ui="+a.ui+"&ce="+a.ce;this.isFirefox()&&(a.amcui=this.getCookie("__amcdnuid"),n+="&amcui="+a.amcui),this.send(n)},_CPA.prototype.handlerMessage=function(e){if("object"!=typeof e||"object"!=typeof e.data)return!1;var t=e.data,o=(void 0!==t.type&&t.type,void 0!==t.action?t.action:""),i=void 0!==t.data?t.data:[];switch(o){case"cpa":try{0<i.length&&window.admq(i)}catch(e){console.log("Post Message Error: ",e)}}};var cpabd_param=void 0===cpabd_param?{}:cpabd_param,_cpabd=new _CPA(cpabd_param);_cpabd.init(),_cpabd.start(),_cpabd.step(),_cpabd.retargetingCreate(_cpabd.cpabd_param.rtg_id,_cpabd.cpabd_param.rtg_id),window.addEventListener?window.addEventListener("hashchange",function(){_cpabd.retargetingCreate(_cpabd.cpabd_param.rtg_id,_cpabd.cpabd_param.rtg_id)},!1):window.attachEvent&&window.attachEvent("onhashchange",function(){_cpabd.retargetingCreate(_cpabd.cpabd_param.rtg_id,_cpabd.cpabd_param.rtg_id)},!1),window.addEventListener?window.addEventListener("message",_cpabd.handlerMessage,!1):window.attachEvent("onmessage",_cpabd.handlerMessage);

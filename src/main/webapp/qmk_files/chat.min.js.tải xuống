"use strict";var ApplicationConfiguration=function(){var e="mean",n=["ngResource","ngMessages","ngCookies","ui.router","ui.bootstrap","ui.utils","environment"],i=function(n,i){angular.module(n,i||[]),angular.module(e).requires.push(n)};return{applicationModuleName:e,applicationModuleVendorDependencies:n,registerModule:i}}();
"use strict";angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider","$httpProvider","envServiceProvider",function(o,t,n){o.html5Mode(!0).hashPrefix("!"),n.config({domains:{development:["localhost","ant.vn"],staging:["ant.chat","kite.ant.chat"],production:["kite.ecovoice.vn"]},vars:{development:{chatWsUrl:"wss://im.ecovoice.vn:443/ws-xmpp",chatDomain:"kite.ecovoice.vn",voiceWsUrl:"wss://voice.ecovoice.vn",voiceDomain:"@prod.anttel-instant.ab-kz-02.antbuddy.com",fbAppId:"763397123795454"},staging:{chatWsUrl:"wss://kite-im.ant.chat:443/ws-xmpp",chatDomain:"anonymous.com",voiceWsUrl:"wss://ab-kz-02.antbuddy.com:8443",voiceDomain:"@staging.anttel-instant.ab-kz-02.antbuddy.com",fbAppId:"763398157128684"},production:{chatWsUrl:"wss://im.ecovoice.vn:443/ws-xmpp",chatDomain:"kite.ecovoice.vn",voiceWsUrl:"wss://voice.ecovoice.vn",voiceDomain:"@prod.anttel-instant.ab-kz-02.antbuddy.com",fbAppId:"761590820642751"}}}),n.check()}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["$rootScope","$state",function(o,t){function n(o,n){o.data&&o.data.ignoreState||(t.previous={state:o,params:n,href:t.href(o,n)})}o.$on("$stateChangeSuccess",function(o,t,a,i,e){n(i,e)})}]),angular.element(document).ready(function(){if(window.location.hash&&"#_=_"===window.location.hash)if(window.history&&history.pushState)window.history.pushState("",document.title,window.location.pathname);else{var o={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=o.top,document.body.scrollLeft=o.left}angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])});
"use strict";!function(t){t.registerModule("chat",["ui.bootstrap","ngStorage","pascalprecht.translate","sdk.launcher","autoheight","angular-google-analytics"]),t.registerModule("chat.routes",["ui.router"])}(ApplicationConfiguration);
"use strict";!function(){function e(e,t){t.otherwise(function(e,t){e.get("$state").transitionTo("not-found",null,{location:!1})}),e.state("home",{url:"/",templateUrl:"modules/chat/client/views/home.client.view.html"}).state("room",{templateUrl:"modules/chat/client/views/room.client.view.html",params:{roomJid:"",roomPin:"",jid:"",token:"",question:"",abOrgKey:"",abRoomKey:"",isOldConnection:!1,customer:void 0,supporter:void 0}}).state("archives",{url:"/archives/:key",templateUrl:"modules/chat/client/views/archive.client.view.html"})}angular.module("chat.routes").config(["$stateProvider","$urlRouterProvider",e])}();
"use strict";!function(){function e(e,n,t){e.load().then(function(){var e=n.googleAnalyticsTrackingID;e?t.configuration.accounts[0].tracker=e:i.shift(),i.length&&(t.registerScriptTags(),t.registerTrackers(),t.pageView())})}var n=angular.module("chat"),i=[{tracker:"UA-XXX-defaultID"}];window.googleAnalyticsTrackingID&&i.push({tracker:window.googleAnalyticsTrackingID}),n.config(["AnalyticsProvider","envServiceProvider",function(e,n){e.setAccount(i).delayScriptTag(!0).ignoreFirstPageLoad(!0),"development"===n.get()&&e.setDomainName("none")}]),n.run(["KiteClientConfigLoader","KiteClientConfig","Analytics",e])}();
"use strict";!function(){var a=angular.module("chat");a.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:"/static/translations/chat/",suffix:".json"}).useMissingTranslationHandlerLog().useSanitizeValueStrategy(null).preferredLanguage("vi")}])}();
"use strict";!function(){function t(t,n,o,e,a,i,r,s,c,u,d,l,f){function h(){return Promise.all([u.loadIcons(),u.loadGroups()])}function m(t){return""}var g,p,v;t.room=void 0,t.user=void 0,t.newMsgBin=[],t.$on("connectionStatus",function(n,o){switch(o){case Strophe.Status.CONNECTED:r.join(t.room.jid,t.room.pin)}}),t.loadHistory=function(){v.loadHistory().then(function(){})},t.toggleExpand=function(){t.isExpanding=!t.isExpanding,t.isExpanding&&setTimeout(function(){$("#room-view").focus()},5)};var w=!1;t.$on("stanzaStatus",function(n,o,e){switch(o){case"ROOM_JOINED":if(w)break;var a=t.user.jid,i=Strophe.getNodeFromJid(a),s=m(i),c=t.user.name||t.user.email||"#Customer",u={nick:r.roomJidResource,name:c,avatar:s};g.addParticipant(u),t.loadHistory(),w=!0}}),e.defaults.headers.common.authorization="Bearer "+n.get('token'),e.get("https://ecovoice.vn/api/users/me").then(function(n){n&&200===n.status&&h().then(function(){return e.get("/api/archives/"+o.key)}).then(function(n){t.room=n.data.room,t.user=n.data.user;var o=n.data.kite.language;o&&"vn"!==o||(o="vi"),a.use(o),g=new c(n.data.kite),p=new d(g),p.watchMsgBins(function(n){t.newMsgBin=n,t.$apply()}),v=new l(p,{})},function(t){console.log("FAIL archives",t)}).then(function(){r.connect(t.user.jid,t.user.token),f.stop()})})["catch"](function(t){console.error(t),alert("forbidden")})}t.$inject=["t","n","o","e","a","i","r","s","c","u","d","l","f"],angular.module("chat").controller("ArchiveController",t),t.$inject=["$scope","$cookies","$stateParams","$http","$translate","$sessionStorage","ChatService","$timeout","ParticipantFactory","EmojiService","MessageStorage","MessageCarrier","NetworkNotification"]}();
"use strict";!function(){function e(e,t,a,n,i,s,o,r,c,u,d,l,m,g,f,p,h,v,b,O,E,M,S,y){function T(){var e=P.messageText;c.sendMessage(e),P.messageText=""}function k(){var t=e.$root.$$phase;"$apply"!==t&&"$digest"!==t&&e.$apply()}function I(){d.loadIcons().then(function(e){P.emojiIcons=e}),d.loadGroups().then(function(e){P.emojiGroups=e})}function N(e){B.addMsgs([{body:g.instant("CHATTING_WITH_MESSAGE",{name:e}),system:!0}]),k()}function R(){var e;e=O.isInWork?O.waitingMsg||g.instant("WAIT_MESSAGE"):g.instant("THANK_YOU_LEAVING_MESSAGE"),B.addMsgs([{body:e,system:!0}])}function A(){var e=g.instant("BUSY_MSG");B.addMsgs([{body:e,system:!0,subtype:"busy"}])}function w(e){/*B.addMsgs([{body:g.instant("CLOSING_CONVERSATION_MESSAGE",{link:e}),system:!0}]),*/l.send("TOOLBAR_DISPLAY_REFRESHBTN"),B.addMsgs([{body:g.instant("REFRESH_CONVERSATION",{fill:O.colors.background}),system:!0}]),k()}function C(){var e=new S({appId:O.originAppId,abKiteServer:O.abKiteServer});e.connect(W.key,Y)}function K(){var e=!1;y.subscribe(function(t){var a=1===t&&!e;1===t&&(e=!0),c.setRoomStatus(t),U=t,$(a)})}function $(e){(e||X>0&&1===U)&&(c.sendEvent("read-by-customer",{lastUnreadMsgId:G}),X=0)}var j,B,D,U,G,P=this,x="",L=g.instant("YOU"),F=_.template(document.getElementById("upload-fail-template").innerHTML),H=[],J=E.getSession(),V=J.room,W=J.customer,q=J.kite,z=J.isOldConnection,Y=J.abRequestMsgId,Q=J.supporter,X=0;P.bowser=bowser,P.newMsgBin=[],P.messageText="",P.sendMessage=T,P.emojiMessage={},P.chatOK=!1,P.voiceOK=!1,P.isSupported=!!Q,P.isJoined=!1,P.isTyping=!1,P.emojiIcons=null,P.emojiGroups=null,P.isShowEmoji=!1,P.colors=O.colors,!function(){L=o.name||L,x=o.icon||"",c.connect(W.jid,W.token),b.onDisconnect(function(){P.chatOK=!1,B.addMsgs([{body:g.instant("NO_INTERNET"),system:!0}]),k()}),b.onReconnect(function(){setTimeout(function(){v.refreshApp()},5e3)}),I()}(),e.$on("connectionStatus",function(e,t){switch(t){case Strophe.Status.CONNECTED:P.chatOK||c.join(V.jid,V.pin);break;case Strophe.Status.DISCONNECTED:P.chatOK=!1}k()}),e.$on("stanzaStatus",function(e,t,a){switch(t){case"ROOM_JOIN_ERROR":P.chatOK=!1;break;case"ROOM_CREATED":break;case"ROOM_JOINED":if(P.chatOK=!0,C(),K(),j=new p({abOrgKey:q.abOrgKey,abRoomKey:q.abRoomKey}),B=new f(j),D=new h(B,{lowerBoundTime:new Date(V.latestRequestTime)}),j.addParticipant({nick:c.roomJidResource,name:L,avatar:x}),B.watchMsgBins(function(e){P.newMsgBin=e,e.forEach(function(e){e.file&&e.file.thumbnailUrl&&(e.noLightBox=!0)}),k()}),!P.isSupported&&O.isInWork){var n=moment.duration(2,"minutes").asMilliseconds()-moment().diff(V.latestRequestTime);n<200&&(n=200),setTimeout(function(){!P.isSupported&&P.chatOK&&(A(),M.trackAgentBusy())},n)}D.loadHistory().then(function(){z||setTimeout(R,300)});break;case"ROOM_LEAVE":P.chatOK=!1;break;case"IS_ROOM_OWNER":break;case"ROOM_PARTICIPANT_JOINED":break;case"ROOM_PARTICIPANT_LEAVED":j.removeParticipant(a);break;case"ROOM_KICKED":P.chatOK=!1,c.leave()}k()}),P.onClickImg=function(e,t){parent.postMessage({task:"show_album",title:e,src:t},o.senderOrigin)};var Z=function(e){var t=!0;if(e.isMe&&e.file&&H.length){var a=_.lastIndexOf(H,e.file.fileUrl);a>=0&&(H.splice(a,1),t=!1)}else"rating"===e.subtype&&(t=!1);return t};e.$on("chatMessage",function(e,t){Z(t)&&(B.addMsgs([t]),t.isMe||(G=t.id,X++),t.isMe||1!==U||$())}),e.$on("eventMessage",function(e,t){var a=t.getAttribute("subtype");switch(a){case"conference-join":break;case"update-profile":}}),e.$on("subEventMessage",function(e,t){if(e=t.getElementsByTagName("event"),e.length){e=e[0];var a=e.getAttribute("type");switch(a){case"kite-start":var n=e.getElementsByTagName("supporterNode")[0].textContent,i=e.getElementsByTagName("supporterName")[0].textContent,s=e.getElementsByTagName("supporterAvatar")[0].textContent;P.isSupported=!0,j.addParticipant({nick:n,name:i,avatar:s}),N(i),M.trackServedByOperator();break;case"kite-close":var o=e.getElementsByTagName("archive-link")[0].textContent;P.chatOK=!1,w(o),c.leave()}}}),e.changeChatState=function(t){if(e.changeChatState.lastAction.state!==t){var a=e.changeChatState,i=a.lastAction,s=i.timeout;switch(i.state,c.sendState(t),s&&(n.cancel([s]),i.timeout=void 0),t){case"composing":i.timeout=n(function(){c.sendState("pause"),i.timeout=void 0,i.state="pause"},3e3);break;case"pause":}i.state=t}},e.$on("chatstateMessage",function(e,t,a){var n=c.roomJidResource;j.getParticipant(a.from).then(function(e){if(e&&e.nick!==n){switch(P.senderName=e.name,t){case"COMPOSING":P.isTyping=!0;break;case"PAUSE":P.isTyping=!1}k()}})}),e.changeChatState.lastAction={timeout:void 0,state:void 0},e.$on("actionEvent",function(e,t,a){switch(t){case"LEAVE":c.leave();break;case"MUTE":break;case"LOCK":c.lock();break;case"VIDEO":break;case"INVITE":}}),P.toggleEmoji=function(){P.isShowEmoji=!P.isShowEmoji,l.send("showEmoji",P.isShowEmoji)},P.uploadFile=function(e,t){if(e.length){var a=e[0];if(t&&t.val(null),a.size>=5e6)return void window.alert("This file is too big. Maximum is 5MB.");var n={from:c.roomJidResource,body:void 0,icon:void 0,name:void 0,isMe:!0,showName:!1,id:(new Date).getTime(),created:void 0,file:{name:a.name,size:a.size,fileUrl:void 0,mimeType:a.type,thumbnailUrl:void 0,thumbnailWidth:void 0,thumbnailHeight:void 0,uploading:0}};if(a.type.match(/^image\//)){n.file.thumbnailUrl="";var i=new FileReader;i.onload=function(e){n.file.thumbnailUrl=i.result,k()},i.readAsDataURL(a)}B.addMsgs([n]),m.upload(a).then(function(e){var t=e.xhr,a=e.formData;t.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;t=Math.round(100*t)/100,n.file.uploading=t,B.updateMsg(n)}},t.upload.ontimeout=t.upload.onerror=function(e){n.file=void 0,n.body=F(),B.updateMsg(n)},t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status){var e=JSON.parse(t.responseText);Object.assign(n.file,e),B.updateMsg(n),H.push(e.fileUrl),c.sendFileMessage(e).then(function(e){n.created=+new Date(e.getAttribute("timestamp")),B.updateMsg(n)})}else n.file=void 0,n.body=F(),B.updateMsg(n)},t.send(a)}),M.trackCustomerUploadFile()}}}e.$inject=["e","t","a","n","i","s","o","r","c","u","d","l","m","g","f","p","h","v","b","O","E","M","S","y"],angular.module("chat").controller("ChatController",e),e.$inject=["$scope","$state","$stateParams","$timeout","$uibModal","$window","$sessionStorage","$sce","ChatService","envService","EmojiService","BroadcastService","FileUploader","$translate","MessageStorage","ParticipantFactory","MessageCarrier","ToolbarControl","NetworkNotification","KiteClientConfig","RequestKiteSession","GoogleAnalyticsTracker","AbKiteClient","ActiveIframeObserver"]}();
"use strict";!function(){function e(e,n,t,o,i,r,a,s,u,c,p,l,d,m,f,g,h,v,I,C){function b(){e.inputFields=u.inputFields||{},["email","name","phone"].forEach(function(n){e.inputFields[n]=_.assign({required:!1,alt:null},e.inputFields[n])})}function S(){e.errorCode=""}function A(){Promise.all([l.fingerprint(),c.load()]).then(function(n){return q=new o({appId:u.originAppId,abKiteServer:u.abKiteServer}),e.labelFormQuestion=u.labelFormQuestion,e.customer.fingerprint=n[0],E(n[0])},function(){return console.error("Error Kite Client: Cannot get fingerprint"),new Error("Cancel")}).then(function(){W(),u.abUser&&_.assign(e.customer,u.abUser)})["catch"](function(e){e&&"Cancel"===e.message||w()})}function K(){m.hideAppChat()}function $(){S(),e.isWaiting=!0,l.saveIdentity(e.customer),h.trackSubmitFormChat(),l.fillMissingInfo(e.customer).then(function(){var n=_.assign(e.customer,{origin:u.senderOrigin,referrer:u.senderReferrer,originAppId:u.appId});return q.requestSupport(n)}).then(function(n){delete i.question,p.setup(n.data),p.goChat(),t(function(){if(e.customer.email.length>0){var n={email:e.customer.email,roomKey:p.getSession().room.key};q.sendTranscript(n).then(function(n){e.isWaiting=!1})}})})["catch"](function(n){var t=new d({"http-resp":n});e.errorCode=t.errorCode,e.isWaiting=!1,e.$apply()})}function y(){var n=[],t=[];t=_.clone(u.coAppIds)||[],t.unshift(u.appId),_.forEach(t,function(e){n.push(q.getRoomInfo(e))}),Promise.all(n).then(function(n){_.forEach(n,function(n){var t=n.data.room,o=u.appIdsExtraData?u.appIdsExtraData[t.appId]:void 0;e.supportRooms.push({original_data:t,extra_data:o})}),g.apply()})}function W(){var n=e.input.selectedRoom;u.originAppId=n?n.original_data.appId:u.appId,q=new o({appId:u.originAppId,abKiteServer:u.abKiteServer})}function F(){H(),i.question=e.customer.question}function R(){l.location()}var k=i.language;k&&"vn"!==k||(k="vi"),r.use(k),moment.locale("en"===k?"en-gb":k),e.isInWork=!0,e.welcomeMessage="We're here to help!",e.startAsking=$,e.isWaiting=!0,e.errorCode=void 0,e.hideAppChat=K,e.headHideButton=!1,e.inputFields=void 0,e.labelFormQuestion=void 0,e.onSelectedSupportRoom=W,e.onChangeQuestion=F,e.supportRooms=[],e.themeName=u.themeName,e.input={selectedRoom:void 0},e.customer={fingerprint:"",email:"",name:"",question:i.question,phone:"",location:void 0,gender:""},e.bowser=bowser,A();var q,w=function(){y(),l.loadIdentity(e.customer),e.isInWork=u.isInWork,e.welcomeMessage=u.title,e.colors=u.colors,r.use(u.language),b(),e.isWaiting=!1,e.$apply()},E=function(e){return p.loadRemoteSession({abKiteClient:q,fingerprint:e}).then(function(){return p.goChat(),Promise.resolve()})};f.addHideBtnListener(function(n){e.headHideButton=n,e.$apply()});var H=_.once(R)}e.$inject=["e","n","t","o","i","r","a","s","u","p","c","l","d","m","f","g","h","v","I","C"],angular.module("chat").controller("HomeController",e),e.$inject=["$scope","$state","$timeout","AbKiteClient","$sessionStorage","$translate","NameGenerator","IpLocation","KiteClientConfig","KiteClientConfigLoader","RequestKiteSession","CustomerAssistant","KiteHttpError","ToolbarControl","HeadButtonService","SafeApply","GoogleAnalyticsTracker","IframeWrapperGATracker","$localStorage","ActiveIframeObserver"]}();
"use strict";!function(){function e(e,t,n,o,i,r,a,s,c,p,l,u){function f(){l.$broadcast("open-rating",{onComplete:function(e){e&&u.trackRating(e.rate,e.comment,!0),n.fingerprint().then(function(e){return A.closeSupportSession(e,S.abRequestMsgId)}).then(function(){})["catch"](function(){})}})}function d(){t.refreshApp()}function h(){t.hideAppChat()}var g=this,S=r.getSession();g.closeConveration=f,g.refreshApp=d,g.hideAppChat=h,g.helloMessage=o.title,g.colors=o.colors,g.headHideButton=i.headHideBtnStatus,g.bowser=bowser;var A=new a({appId:o.originAppId,abKiteServer:o.abKiteServer}),b=!1;Object.defineProperties(g,{displayRefreshBtn:{get:function(){return b}}}),e.$on("TOOLBAR_DISPLAY_REFRESHBTN",function(){b=!0,g.popoverRattingIsOpen=!0,p.apply()})}e.$inject=["e","t","n","o","r","i","a","s","c","p","l","u"],angular.module("chat").controller("ToolbarController",e),e.$inject=["$scope","ToolbarControl","CustomerAssistant","KiteClientConfig","HeadButtonService","RequestKiteSession","AbKiteClient","$window","$translate","SafeApply","$rootScope","GoogleAnalyticsTracker"]}();
"use strict";!function(){function e(e,n,t,o,i,a){function c(){E=document.getElementById("audioRemote"),b=document.getElementById("audioLocal"),m=t.roomUrl,a.create(p,m).then(function(e){a.connect(e.data.user.device.sip,E,b)},function(){console.log("voice failed"),d("Failed to establish instant voice call. Chat only mode")})}function r(e){return""}function s(e,n){return n=n||!1,{id:e,name:e,icon:r(e),isMe:n}}function u(e,n){var t=_.find(h.participants,function(n){return n.id===e});t||h.participants.push(s(e,n))}function l(e){_.remove(h.participants,function(n){return n.id===e})}function f(e){return _.find(h.participants,function(n){return n.id===e})}function v(e){var n=e.getAttribute("from");n=Strophe.getResourceFromJid(n);var t=f(n);if(!t)return void console.log("could not find user");var o=e.getElementsByTagName("name");o.length&&(t.name=Strophe.getText(o[0]));var i=e.getElementsByTagName("avatar");i.length&&(t.icon=Strophe.getText(i[0]))}function O(){var n=e.$root.$$phase;"$apply"!==n&&"$digest"!==n&&e.$apply()}function d(e,n){n=parseInt(n)||3,h.showInfo=!0,h.infoMsg=e,o(function(){h.showInfo=!1},1e3*n)}function g(){h.participants=[],E.src=null,b.src=null}var h=this,p="",m="",E=null,b=null;h.chatOK=!1,h.voiceOK=!1,h.voiceDisable=!1,h.showInfo=!0,h.participants=[],h.infoMsg="Connecting...",h.isOwner=!1,(new Fingerprint2).get(function(e){p=e,c()}),e.$on("stanzaStatus",function(e,t,o){switch(t){case"ROOM_JOIN_ERROR":h.chatOK=!1;break;case"ROOM_CREATED":break;case"ROOM_JOINED":h.chatOK=!0,u(o,!0);break;case"ROOM_PARTICIPANT_JOINED":u(o);break;case"ROOM_LEAVE":h.chatOK=!1,g(),n.go("home");break;case"ROOM_PARTICIPANT_LEAVED":l(o);break;case"IS_ROOM_OWNER":h.isOwner=!0;break;case"ROOM_KICKED":h.chatOK=!1,a.leave(),g(),d("You have kicked from admin")}O()}),e.$on("eventMessage",function(e,n){var t=n.getAttribute("subtype");switch(t){case"conference-join":break;case"update-profile":o(function(){v(n)})}O()}),e.$on("actionEvent",function(e,n){switch(n){case"LEAVE":a.leave();break;case"MUTE":a.mute();break;case"LOCK":break;case"VOICE":h.voiceOK?(a.leave(),h.voiceDisable=!0):(a.join(),h.voiceDisable=!1)}O()}),e.$on("VOICE_EVENT",function(e,n,t){switch(n){case"voiceConnected":h.voiceOK||h.voiceDisable||(a.join(),h.infoMsg="Preparing to join...");break;case"voiceIncoming":break;case"voiceInprogress":console.log("voiceInprogress"),h.showInfo=!1,h.voiceOK=!0;break;case"voiceError":h.voiceOK=!1,d("Failed to establish instant voice call, Chat only mode");break;case"voiceEnd":h.voiceOK=!1,h.chatOK&&d("Chat only mode")}O()})}e.$inject=["e","n","t","o","a","i"],angular.module("chat").controller("VoiceController",e),e.$inject=["$scope","$state","$stateParams","$timeout","$sessionStorage","VoiceService"]}();
"use strict";!function(){function t(){return function(t,n){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),n=n||0;var r,a,u="#";for(a=0;a<3;a++)r=parseInt(t.substr(2*a,2),16),r=Math.round(Math.min(Math.max(0,r+r*n),255)).toString(16),u+=("00"+r).substr(r.length);return u}}angular.module("chat").filter("colorLuminace",t)}();
"use strict";angular.module("chat").filter("emoji",function(){var e=new RegExp(":[a-z0-9_+-]*:","g");return function(t){return t.replace(e,function(e,t){return'<i class="emoji emoji_'+t+'" title=":'+t+':">'+t+"</i>"})}});
"use strict";!function(){function t(t){return function(e){return e=t.translateUrl(e),e=t.translateEmojis(e),e=t.translateNewLine(e)}}t.$inject=["t"],angular.module("chat").filter("formatMessage",t),t.$inject=["FormatMessage"]}();
"use strict";angular.module("chat").filter("html",["$sce",function(t){return function(r){return t.trustAsHtml(r)}}]);
"use strict";!function(){function e(){function e(e,t,n){}function t(e,t,n,i,s,a,c,o){function u(){e.focusingTab="email"}function l(){e.focusingTab="phone"}function r(){e.focusingTab="name"}function p(){e.isUpdating||(e.isUpdating=!0,a.fingerprint().then(function(t){var n=new i({appId:s.originAppId,abKiteServer:s.abKiteServer});return n.updateUser(t,e.input)}).then(function(t){e.showSuccessText=!0,_.delay(function(){e.isUpdating=!1,n.apply()},500),_.delay(function(){e.showSuccessText=!1,n.apply()},4e3)})["catch"](function(){_.delay(function(){e.isUpdating=!1},500)}),o.trackCustomerLeaveInfo())}function f(){e.$on("subEventMessage",function(t,i){if(t=i.getElementsByTagName("event"),t.length){t=t[0];var s=t.getAttribute("type");switch(s){case"kite-start":case"kite-close":e.isBusy=!1,n.apply()}}})}e.selectEmailOpt=u,e.selectPhoneOpt=l,e.selectNameOpt=r,e.focusingTab=void 0,e.submit=p,e.isUpdating=!1,e.isBusy=!0,e.showSuccessText=!1,e.colors=s.colors,e.input={email:_.get(c,"customer.email"),phone:_.get(c,"customer.phone"),name:_.get(c,"customer.name")||""},e.input.name.indexOf(" from ")>=0&&(e.input.name=""),u(),f()}return{restrict:"E",scope:{message:"=ngModel"},templateUrl:"/modules/chat/client/views/templates/busy-message.client.view.html",link:e,controller:["$scope","$translate","SafeApply","AbKiteClient","KiteClientConfig","CustomerAssistant","$stateParams","GoogleAnalyticsTracker",t]}}angular.module("chat").directive("busyMessage",e),e.$inject=[]}();
"use strict";!function(){function t(){function t(t,o,e){if(bowser.ios&&bowser.mobile){var n=t.chatBoxWrapIos(),i=$(o[0]);i.on("focusin",n["text-input-selector"],function(t){o.addClass("text-input-focused")}),i.on("focusout",n["text-input-selector"],function(t){o.removeClass("text-input-focused")}),i.on("touchmove",function(t){var o=t.originalEvent.target,e=$(o);!i.is(e)&&i.has(o).length>0||t.preventDefault()})}}return{restrict:"A",link:t,scope:{chatBoxWrapIos:"&"}}}angular.module("chat").directive("chatBoxWrapIos",t),t.$inject=[]}();
"use strict";
"use strict";!function(){function e(e,t,n,i,r){function a(e,t,n,r){var a=e.emailValidationFeedback()["input-name"],o=$(t).find("input[name='"+a+"']"),l=o[0],c=r[a];c.firstShow=!1,o.one("blur",function(){c.firstShow=!0,i.apply()}),Object.defineProperties(c,{required:{get:function(){return!!l.attributes.required}},element:{get:function(){return o}}}),e.inputModelCtrl=c,u(e,t)}function o(){var t="/modules/chat/client/views/templates/email-validation-feedback.view.html",i=e.getTrustedResourceUrl(t);return n(i)}function u(e,n){var i=l(e,n);o().then(function(e){var r=t(e)(i);n.append(r)})}function l(e,t){function n(e){return 2===e.split("@").length}function a(){var e=c.$viewValue,n=c.$valid,r=!n&&!!e.length,a=n&&!!e.length,u=c.required&&!e.length;_.assign(l,{hasError:r,hasSuccess:a,hasRequire2Input:u}),t.toggleClass("has-error",r),t.toggleClass("has-success",a),o(c),i.apply()}function o(e){var t=e.element.attr("placeholder");if(t.indexOf("translate")<0){var n=t,i="* ";0!==n.indexOf(i)||e.required?0!==n.indexOf(i)&&e.required&&(n=i+n):n=n.replace(i,""),t!==n&&e.element.attr("placeholder",n)}}function u(){if(bowser.ios&&bowser.mobile){var n=new Rx.Subject;e.$on("$destroy",function(){return n.onNext()});var r=function(){t.toggleClass("has-feedback",!l.hideIconFeedback),i.apply()},a=Rx.Observable.fromEvent(t,"touchstart").takeUntil(n).doOnNext(function(){l.hideIconFeedback=!0,r()}),o=Rx.Observable.fromEvent(t,"touchend").takeUntil(n).doOnNext(function(){l.hideIconFeedback=!1,r()});a.doOnNext(function(){o.take(1).subscribe()}).subscribe()}}var l=e.$new(!0),c=e.inputModelCtrl,s=_.debounce(a,150);return r(function(){o(c)}),l.inputModelCtrl=c,l.inputModelCtrl.$viewChangeListeners.push(a),l.inputModelCtrl.$parsers.push(function(e){return s(),e}),l.hasOneAt=_.memoize(n),a(),u(),l}return{require:"^form",restrict:"A",link:a,scope:{emailValidationFeedback:"&"}}}e.$inject=["e","t","n","i","r"],angular.module("chat").directive("emailValidationFeedback",e),e.$inject=["$sce","$compile","$templateRequest","SafeApply","$timeout"]}();
"use strict";!function(){angular.module("chat").directive("emojiGroupMenu",function(){return{restrict:"E",scope:{model:"=ngModel",emojiGroups:"=ngEmojiGroups",emojiIcons:"=ngEmojiIcons",textareaId:"=textareaId"},templateUrl:"/modules/chat/client/views/emoji.client.view.html",controller:["$scope",function(e){var o,t=!0,n=function(){o=_.keys(e.emojiGroups),e.emojiGroups[0].active=!0,e.hoverEmoji="",e.isShowMenu=!1,e.input=document.getElementById(e.textareaId)};e.activeGroup=function(t){_.each(o,function(o){e.emojiGroups[o].active=!1}),t.active=!0},e.toggleEmojiMenu=function(){t&&(n(),t=!1),e.isShowMenu=!e.isShowMenu},e.selectEmoji=function(o){o=o.split(" ")[0];var t=e.input.selectionStart,n=t+1,i=t+o.length,u=e.input.value,c=u.length;u=u.substr(0,t)+o+u.substring(n,c),e.model=u,setTimeout(function(){e.input.focus(),e.input.setSelectionRange(i,i)},50)},e.$on("showEmoji",function(){e.toggleEmojiMenu()})}],link:function(e,o){var t=o.find(".emoji-menu-body");t.on("mouseover","li",function(o){e.hoverEmoji=o.target.value,e.$apply()}),document.querySelector("emoji-group-menu").addEventListener("click",function(e){e.stopPropagation()}),document.querySelector("html").addEventListener("click",function(o){o.currentTarget.querySelector("emoji-group-menu")&&(e.isShowMenu=!1,e.$apply())})}}})}();
"use strict";!function(){function e(){function e(e,t,i){}return{restrict:"E",scope:{message:"=ngModel"},templateUrl:"/modules/chat/client/views/templates/file-message.client.view.html",link:e}}angular.module("chat").directive("fileMessage",e),e.$inject=[]}();
"use strict";!function(){function t(){function t(t,u,i){var n=$(u),c=i.focusAfterSubmit;n.on("submit",function(t){n.find(c).focus()})}return{restrict:"A",link:t}}angular.module("chat").directive("focusAfterSubmit",t)}();
"use strict";!function(){function e(){function e(e,n,t,l){e.name=t.name}function n(e){function n(n){e.ngModel=n}e.genderOptions=[{val:"m",translate:"GENDER_TYPE.MALE"},{val:"f",translate:"GENDER_TYPE.FEMALE"}],e.updateModel=n,e.input={val:e.ngModel||e.genderOptions[0].val},n(e.input.val)}return{require:"^form",restrict:"E",scope:{ngModel:"="},link:e,controller:["$scope",n],templateUrl:"modules/chat/client/views/templates/gender-input.client.view.html"}}angular.module("chat").directive("genderInput",e)}();
"use strict";!function(){function o(){function o(o,s,e){bowser.mobile&&(s.addClass("mobile"),bowser.ios&&bowser.chrome?s.addClass("mobile-ios-chrome"):bowser.ios&&bowser.safari?s.addClass("mobile-ios-safari"):bowser.ios&&bowser.firefox?s.addClass("mobile-ios-firefox"):bowser.android&&bowser.chrome?s.addClass("mobile-android-chrome"):bowser.android&&bowser.firefox&&s.addClass("mobile-android-firefox"))}return{restrict:"A",link:o}}angular.module("chat").directive("mobileClass",o),o.$inject=[]}();
"use strict";angular.module("chat").directive("msgView",["$templateRequest","$sce","$compile","$timeout","MessageTracker","KiteClientConfig",function(e,t,r,a,o,n){var i,s=t.getTrustedResourceUrl("modules/chat/client/views/templates/message.client.view.html");e(s).then(function(e){i=e},function(){});var c=function(e,t){var r=e.$new(!0);return Object.assign(r,{message:t,moment:moment,colors:n.colors}),r},l=function(e,t){return!e||!t||new Date(e).toDateString()===new Date(t).toDateString()},u=function(e){var t=e.length;e[0].isNewDate=!0;for(var r=e[0].created,a=1;a<t;a++){var o=e[a];o.isNewDate=!l(r,o.created),o.isNewDate&&(r=o.created)}return e},d=function(e){var t=e.length;e[0].showName=!0;for(var r=1;r<t;r++){var a=e[r];a.showName=e[r-1].from!==a.from}return e};return{restrict:"A",link:function(e,t,n){var s,f,v,m=new o,g=function(e,r){var a=t.hasClass("scroller")?t:$(t).closest(".scroller"),o=_.after(e,function(){return r&&!s?(f?clearTimeout(f):v=r,void(f=setTimeout(function(){v.scrollIntoView(!1);var e=0;$(v).prevAll().each(function(){e+=$(this).outerHeight()}),a.prop("scrollTop",e),f=void 0,v=void 0},200))):1===e?void a.prop("scrollTop",a.prop("scrollHeight")):(s&&clearTimeout(s),void(s=setTimeout(function(){a.prop("scrollTop",a.prop("scrollHeight")),s=void 0},200)))});return o},p=function(o){var n=c(e,o),s=r(i)(n),l=$(t).find("#"+o.id),u=function(){};o.created&&(m.trackMsg(o),u=g(1)),a(function(){var e=s[2];l.replaceWith(e),u()},50)};e.$watch(n.msgView,function(o){if(_.isArray(o)&&o.length){var n,s,f=(!!e.isLoadingHistory,o.length);if(1===f&&o[0].updated===!0)return void p(o[0]);if(o=_.sortBy(o,["created"]),o=_.flow(u,d)(o),!m.latestMsg||!o[0].created||m.latestMsg.created<=o[0].created){var v=o[0];if(m.latestMsg&&!v.system){v.showName=v.from!==m.latestMsg.from;var h=v.created||new Date;v.isNewDate=!l(h,m.latestMsg.created)}s=t.append.bind(t),n=g(f)}else{o=o.reverse(),s=t.prepend.bind(t);var w=t[0];if(l(m.oldestMsg.created,o[0].created)){var $=w.querySelector(".row-date");$&&$.parentNode.removeChild($)}var D=w.querySelector(".chat-message");n=g(f,D)}_.each(o,function(t){t.created?m.trackMsg(t):t.isNewDate=!1;var o=c(e,t),l=r(i)(o);"internal"!==t.subtype&&s(l),a(function(){t.system||o.$destroy(),n()},50)})}})}}}]);
"use strict";!function(){function e(e,t,n,r,i){function a(e,t,n,i){var a=e.nameValidationFeedback()["input-name"],o=$(t).find("input[name='"+a+"']"),c=o[0],l=i[a];l.firstShow=!1,o.one("blur",function(){l.firstShow=!0,r.apply()}),Object.defineProperties(l,{required:{get:function(){return!!c.attributes.required}},element:{get:function(){return o}}}),e.inputModelCtrl=l,u(e,t)}function o(){var t="/modules/chat/client/views/templates/name-validation-feedback.view.html",r=e.getTrustedResourceUrl(t);return n(r)}function u(e,n){var r=c(e,n);o().then(function(e){var i=t(e)(r);n.append(i)})}function c(e,t){function n(){var e=c.$viewValue,n=c.$valid,i=!n&&!!e.length,o=n&&!!e.length,l=c.required&&!e.length;_.assign(u,{hasError:i,hasSuccess:o,hasRequire2Input:l}),t.toggleClass("has-error",i),t.toggleClass("has-success",o),a(c),r.apply()}function a(e){var t=e.element.attr("placeholder");if(t.indexOf("translate")<0){var n=t,r="* ";0!==n.indexOf(r)||e.required?0!==n.indexOf(r)&&e.required&&(n=r+n):n=n.replace(r,""),t!==n&&e.element.attr("placeholder",n)}}function o(){if(bowser.ios&&bowser.mobile){var n=new Rx.Subject;e.$on("$destroy",function(){return n.onNext()});var i=function(){t.toggleClass("has-feedback",!u.hideIconFeedback),r.apply()},a=Rx.Observable.fromEvent(t,"touchstart").takeUntil(n).doOnNext(function(){u.hideIconFeedback=!0,i()}),o=Rx.Observable.fromEvent(t,"touchend").takeUntil(n).doOnNext(function(){u.hideIconFeedback=!1,i()});a.doOnNext(function(){o.take(1).subscribe()}).subscribe()}}var u=e.$new(!0),c=e.inputModelCtrl,l=_.debounce(n,150);return i(function(){a(c)}),u.inputModelCtrl=c,u.inputModelCtrl.$viewChangeListeners.push(n),u.inputModelCtrl.$parsers.push(function(e){return l(),e}),n(),o(),u}return{require:"^form",restrict:"A",link:a,scope:{nameValidationFeedback:"&"}}}e.$inject=["e","t","n","r","i"],angular.module("chat").directive("nameValidationFeedback",e),e.$inject=["$sce","$compile","$templateRequest","SafeApply","$timeout"]}();
"use strict";!function(){function n(){function n(n,t,e){t.bind("keydown",function(t){13!==t.which||t.shiftKey||(n.$apply(function(){n.$eval(e.ngEnter,{e:t})}),t.preventDefault())})}return{restrict:"A",link:n}}angular.module("chat").directive("ngEnter",n)}();
"use strict";!function(){function t(){function t(t,i,c){$(i).on("click",".chat-message-details img",function(i){var c=this.getAttribute("alt"),e=this.getAttribute("src");e=e.replace("thumb_",""),t.onClickAbImg({title:c,src:e})})}return{restrict:"A",link:t,scope:{onClickAbImg:"&"}}}angular.module("chat").directive("onClickAbImg",t),t.$inject=[]}();
"use strict";angular.module("chat").directive("participant",["$uibModal","$timeout","ChatService",function(n,i,e){return{scope:{info:"=info",isOwner:"=owner"},templateUrl:"/modules/chat/client/views/participant.client.views.html",link:function(o,t){o.info.name===o.info.id&&(o.info.name=o.info.isMe?"You":"Your Friend"),o.openProfileDialog=function(){var t=n.open({animation:!1,backdrop:"static",templateUrl:"/modules/chat/client/views/profile.client.modal.html",controller:"ProfileController",resolve:{info:function(){return o.info},isOwner:function(){return o.isOwner}}});t.result.then(function(n){o.info.name=n.name||"You",e.updateProfile(n.name,n.icon)},function(n){}),t.rendered.then(function(){i(function(){t.initVideo()},200)})},o.openKickDialog=function(){n.open({templateUrl:"/modules/chat/client/views/kick.client.modal.html",controller:function(n,i,e,o){n.cancel=function(){i.dismiss("cancel")},n.yes=function(){i.close(e.id)}},resolve:{info:function(){return o.info},isOwner:function(){return o.isOwner}}}).result.then(function(n){e.kick(n)},function(n){})}}}}]);
"use strict";!function(){function e(e,t,n,r,i){function o(e,t,n,i){var o=e.phoneValidationFeedback()["input-name"],a=$(t).find("input[name='"+o+"']"),c=a[0],l=i[o];l.firstShow=!1,a.one("blur",function(){l.firstShow=!0,r.apply()}),Object.defineProperties(l,{required:{get:function(){return!!c.attributes.required}},element:{get:function(){return a}}}),e.inputModelCtrl=l,u(e,t)}function a(){var t="/modules/chat/client/views/templates/phone-validation-feedback.view.html",r=e.getTrustedResourceUrl(t);return n(r)}function u(e,n){var r=c(e,n);a().then(function(e){var i=t(e)(r);n.append(i)})}function c(e,t){function n(e){return/^\d+$/.test(e)}function o(){var e=l.$viewValue,n=l.$valid,i=!n&&!!e.length,o=n&&!!e.length,u=l.required&&!e.length;_.assign(c,{hasError:i,hasSuccess:o,hasRequire2Input:u}),t.toggleClass("has-error",i),t.toggleClass("has-success",o),a(l),r.apply()}function a(e){var t=e.element.attr("placeholder");if(t.indexOf("translate")<0){var n=t,r="* ";0!==n.indexOf(r)||e.required?0!==n.indexOf(r)&&e.required&&(n=r+n):n=n.replace(r,""),t!==n&&e.element.attr("placeholder",n)}}function u(){if(bowser.ios&&bowser.mobile){var n=new Rx.Subject;e.$on("$destroy",function(){return n.onNext()});var i=function(){t.toggleClass("has-feedback",!c.hideIconFeedback),r.apply()},o=Rx.Observable.fromEvent(t,"touchstart").takeUntil(n).doOnNext(function(){c.hideIconFeedback=!0,i()}),a=Rx.Observable.fromEvent(t,"touchend").takeUntil(n).doOnNext(function(){c.hideIconFeedback=!1,i()});o.doOnNext(function(){a.take(1).subscribe()}).subscribe()}}var c=e.$new(!0),l=e.inputModelCtrl,s=_.debounce(o,150);return i(function(){a(l)}),c.inputModelCtrl=l,c.inputModelCtrl.$viewChangeListeners.push(o),c.inputModelCtrl.$parsers.push(function(e){return s(),e}),c.isOnlyNumber=_.memoize(n),o(),u(),c}return{require:"^form",restrict:"A",link:o,scope:{phoneValidationFeedback:"&"}}}e.$inject=["e","t","n","r","i"],angular.module("chat").directive("phoneValidationFeedback",e),e.$inject=["$sce","$compile","$templateRequest","SafeApply","$timeout"]}();
"use strict";!function(){function e(){function e(e,o,t){if(bowser.ios&&bowser.mobile){var n=e.preventTouchMoveIos()||{},i=n["allow-tmove-child"]===!0,r=$(o);r.on("touchmove",function(e){var o=e.originalEvent.target,t=$(o);i&&!r.is(t)&&r.has(o).length>0||e.preventDefault()})}}return{restrict:"A",link:e,scope:{preventTouchMoveIos:"&"}}}angular.module("chat").directive("preventTouchMoveIos",e),e.$inject=[]}();
"use strict";!function(){function e(){function e(e,o,t){if(bowser.ios&&bowser.mobile){var n,r=(angular.element(document.body),$(o));r.on("touchstart",function(e){n=e.originalEvent.touches[0].screen}),o[0].addEventListener("touchmove",function(e){var o=e.touches[0].screenY;if(o<=n)return void(n=o);n=o;var t=r.prop("scrollTop");0===t&&e.preventDefault()},!1)}}return{restrict:"A",link:e}}angular.module("chat").directive("preventTouchMoveOverTopIos",e)}();
"use strict";!function(){function t(){function t(){}function n(t,n,e,i,o,r,a,c){function s(){var t=l();t.result.then(function(){a.trackRating(h.rate,h.comment)})}function l(){var t=_.assign({},h),n=e.open({templateUrl:"modules/chat/client/views/modals/rating.client.view.html",resolve:{rating:function(){return h}},controller:["$scope","$uibModalInstance","rating",function(n,e,i){function o(){e.close(i)}function r(){_.assign(i,t),e.dismiss("cancel")}n.ok=o,n.cancel=r,n.rating=i}]});return n.result=n.result.then(function(t){return u(h)},function(t){}),n}function u(t){var n=JSON.stringify(t);return c.sendMessage(n,"rating"),d.sendRating(v.key,p.abRequestMsgId,t)}function g(){t.$on("open-rating",function(t,n){if(h.comment||h.rate)return n.onComplete();var e=l();e.result.then(function(){n.onComplete(h)})["catch"](function(){n.onComplete()})})}function f(){t.$on("subEventMessage",function(n,e){if(n=e.getElementsByTagName("event"),n.length){n=n[0];var i=n.getAttribute("type");switch(i){case"kite-close":t.displayRatingBtn=!1,r.apply()}}})}var m=i.colors,p=n.getSession(),v=p.customer,d=new o({appId:i.originAppId,abKiteServer:i.abKiteServer}),h=_.assign({comment:"",rate:0},p.rating);t.openModalRating=s,t.colors=m,t.rating=h,t.displayRatingBtn=!0,g(),f()}return{restrict:"E",templateUrl:"modules/chat/client/views/rating.client.view.html",controller:["$scope","RequestKiteSession","$uibModal","KiteClientConfig","AbKiteClient","SafeApply","GoogleAnalyticsTracker","ChatService",n],link:t}}angular.module("chat").directive("rating",t),t.$inject=[]}();
"use strict";!function(){function e(){function e(e,n,r){var t=$(n);t.on("keypress",function(e){13===e.keyCode&&t.blur()})}return{restrict:"A",link:e}}angular.module("chat").directive("removeForcus",e)}();
"use strict";!function(){function e(){function e(e,i,t){function n(e,i){_.includes(c,e)?r.hide():r.show()}var r=$(i),c=["facebook","skype","viber"];e.$watch(t.requireKiteWebView,n)}return{restrict:"A",link:e}}angular.module("chat").directive("requireKiteWebView",e),e.$inject=[]}();
"use strict";!function(){function e(){function e(e,t,a){var n=moment(e.message.created).format("MMM DD, YYYY");e.formatedDate=n}return{restrict:"E",scope:{message:"=ngModel"},templateUrl:"/modules/chat/client/views/templates/row-date.client.view.html",link:e}}angular.module("chat").directive("rowDate",e),e.$inject=[]}();
"use strict";!function(){function t(t){function n(n){var a=t.$$phase;"$apply"===a||"$digest"===a?n&&"function"==typeof n&&n():t.$apply(n)}var a={apply:n};return a}t.$inject=["t"],angular.module("chat").factory("SafeApply",t),t.$inject=["$rootScope"]}();
"use strict";!function(){function e(e,n,t){function i(i,a,r){function s(i){e.senderOrigin&&0===e.senderOrigin.indexOf(i.origin)&&"scaled-iframe"===i.data.type&&("none"!==i.data.val?a.addClass("scaled"):a.removeClass("scaled"),t(function(){n.$broadcast("autoheight-adjust")}))}window.addEventListener("message",s,!1)}return{restrict:"A",link:i}}e.$inject=["e","n","t"],angular.module("chat").directive("scaleIframeListener",e),e.$inject=["KiteClientConfig","$rootScope","$timeout"]}();
"use strict";angular.module("chat").directive("scrollBottom",["$timeout",function(e){return{scope:{messages:"=scrollBottom"},link:function(n,t){n.$watchCollection("messages",function(){e(function(){t.prop("scrollTop",t.prop("scrollHeight"))},100)})}}}]),angular.module("chat").directive("fileChange",function(){return{restrict:"A",scope:{fileChange:"="},link:function(e,n){n.bind("change",function(t){e.fileChange(t.target.files,angular.element(n))})}}}),angular.module("chat").directive("whenScrolled",function(){return function(e,n,t){var o=n[0];n.bind("scroll",function(){0===o.scrollTop&&e.$apply(t.whenScrolled)})}});
"use strict";!function(){function n(){function n(){}function e(n,e,i,t,a,o){function c(){p.email?(p.enable=!0,f.sendTranscript(p).then(function(n){_.assign(p,n.data),u=p.email,r()})["catch"](function(n){p.enable=!1,t.apply()}),o.trackSendEmail()):(r(),p.email=u)}function r(){n.popoverConfig.isOpen=!1}function s(){p.enable=!1,f.sendTranscript(p).then(function(n){_.assign(p,n.data)})["catch"](function(n){p.enable=!0,t.apply()})}var l=e.getSession(),p={email:l.customer.email,enable:!1,roomKey:l.room.key};_.assign(p,l.room.sendTranscript);var f=new i({appId:a.originAppId,abKiteServer:a.abKiteServer}),u=p.email;n.popoverIsOpen=!1,n.okConfig=c,n.cancelConfig=r,n.cancelSendingTranscript=s,n.config=p,n.popoverConfig={isOpen:!1}}return{restrict:"E",templateUrl:"modules/chat/client/views/sendingTranscript.client.view.html",link:n,controller:["$scope","RequestKiteSession","AbKiteClient","SafeApply","KiteClientConfig","GoogleAnalyticsTracker",e]}}angular.module("chat").directive("sendingTranscript",n),n.$inject=[]}();
"use strict";!function(){function n(){function n(n,e,r){function o(r){var o=n.styleOnHover();for(var t in o)s[t]=e.css(t),e.css(t,o[t])}function t(n){for(var r in s)e.css(r,s[r]);s={}}e.on("mouseenter",o),e.on("mouseleave",t);var s={}}return{restrict:"A",link:n,scope:{styleOnHover:"&"}}}angular.module("chat").directive("styleOnHover",n)}();
"use strict";!function(){function e(){function e(e,t,s){}return{restrict:"E",scope:{message:"=ngModel"},templateUrl:"/modules/chat/client/views/templates/system-message.client.view.html",link:e}}angular.module("chat").directive("systemMessage",e),e.$inject=[]}();
"use strict";!function(){function t(){function t(t,e,i){}function e(t,e){t.colors=e.colors}return{restrict:"E",templateUrl:"/modules/chat/client/views/templates/tstyle.client.view.html",link:t,controller:["$scope","KiteClientConfig",e]}}angular.module("chat").directive("tstyle",t),t.$inject=[]}();
"use strict";angular.module("chat").factory("AbKiteClient",["$rootScope","$http",function(t,s){var n=function(t){var n=t.appId,r=t.abKiteServer;this.requestSupport=function(t){return s.post("//"+r+"/api/kites/"+n+"/request-support",t)},this.updateUser=function(t,n){return s.put("//"+r+"/api/users/"+t,n)},this.findSupportSession=function(t){return s.get("//"+r+"/api/users/"+t+"/support-sessions?appId="+n)},this.closeSupportSession=function(t,n){return s.put("//"+r+"/api/users/"+t+"/support-sessions/"+n+"/close")},this.sendTranscript=function(t){return s.put("//"+r+"/api/rooms/"+t.roomKey+"/send-transcript",{appId:n,sendTranscript:t})},this.getRoomInfo=function(t){return s.get("//"+r+"/api/kites/"+t+"/get-room-info")},this.sendRating=function(t,n,e){return s.put("//"+r+"/api/users/"+t+"/support-sessions/"+n+"/rating",e)},this.connect=function(t,n){return s.put("//"+r+"/api/users/"+t+"/support-sessions/"+n+"/connect",{})}};return n}]);
"use strict";!function(){function n(n){function i(){n.subscribe(function(n){t=n,u("hidden"===n?0:1)}),Rx.Observable.fromEvent(window,"focus").doOnNext(function(){u(1)}).subscribe(function(){},void 0,void 0),Rx.Observable.fromEvent(window,"blur").doOnNext(function(){u(0)}).subscribe(function(){},void 0,void 0)}function e(n){o!==n&&("hidden"===t&&1===n||(o=n,c.onNext(o)))}var o=0,t=void 0,c=new Rx.BehaviorSubject(o),u=_.debounce(e,300);return i(),c}n.$inject=["n"],angular.module("chat").factory("ActiveIframeObserver",n),n.$inject=["VisibilityIframe"]}();
"use strict";angular.module("chat").factory("BroadcastService",["$rootScope",function(t){return{send:function(c,o,r){t.$broadcast(c,o,r)}}}]);
"use strict";angular.module("chat").service("ChatService",["$rootScope","$window","$timeout","$q","BroadcastService","envService","NetworkNotification",function(t,e,n,i,o,r,s){function a(){return(new Date).getTime()}var u=this;this.jid="",this.roomJidResource=void 0,this.connectionStatus=Strophe.Status.DISCONNECTED,Strophe.SASLSHA1.test=function(){return!1},Strophe.SASLMD5.test=function(){return!1};var c=function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var e="-";return t()+t()+e+t()+e+t()+e+t()+e+t()+t()+t()},m=function(t){console.log(t),this.connectionStatus=t,o.send("connectionStatus",t)},d=function(){return Math.random().toString(36).substring(2,15)},l=function(t){var e=t.getElementsByTagName("file");if(e.length){var n=e[0],i={name:Strophe.getText(n.getElementsByTagName("name")[0]),size:Strophe.getText(n.getElementsByTagName("size")[0]),fileUrl:Strophe.getText(n.getElementsByTagName("fileUrl")[0]),mimeType:Strophe.getText(n.getElementsByTagName("mimeType")[0]),thumbnailUrl:Strophe.getText(n.getElementsByTagName("thumbnailUrl")[0]),thumbnailWidth:Strophe.getText(n.getElementsByTagName("thumbnailWidth")[0]),thumbnailHeight:Strophe.getText(n.getElementsByTagName("thumbnailHeight")[0]),uploading:100};return i}},h=function(t){if(t.getElementsByTagName("attention").length)return!1;var e=Strophe.getResourceFromJid(t.getAttribute("from")),n=e===this.roomJidResource,i=t.getAttribute("type"),o=t.getAttribute("subtype"),r=t.getAttribute("id"),s=t.getElementsByTagName("body");if(s.length&&(s=Strophe.getText(s[0])),!s)return!1;var a={isMe:n,from:e,body:s,file:l(t),type:i,subtype:o,id:r,created:+new Date(t.getAttribute("timestamp"))};return a};this.getRoomFullJid=function(){return this.roomJidResource=this.jid.split("@")[0],this.roomJid+"/"+this.roomJidResource},this.connect=function(t,e){this.jid=t,this.connection?this.connection.reset():(this.connection=new Strophe.Connection(r.read("chatWsUrl"),{mechanisms:[Strophe.SASLPlain]}),s.init({stropheConn:this.connection})),this.connection.connect(this.jid,e,m)},this.leave=function(){var t=$pres({to:this.getRoomFullJid(),type:"unavailable"});this.send(t),o.send("stanzaStatus","ROOM_LEAVE")},this.join=function(t,e){var n=c();this.roomJid=t;var i=$pres({to:this.getRoomFullJid(),id:n}).c("x",{xmlns:"http://jabber.org/protocol/muc"}).c("password").t(e);this.addPresenceHandlers(),this.send(i)},this.fetchMessage=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=_.clamp(t,10,50);var o=d(),r=i?"before":"after",s=$iq({to:this.roomJid,type:"get",id:o}).c("query",{xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(t).up();s=n?s.c(r).t(moment(n).utc().toISOString()):s.c(r);var a=new Promise(function(t,n){e.connection.addHandler(function(i){var o=i.getAttribute("type");if("error"===o)return n(i),!1;var r=i.getAttribute("from"),s=i.getElementsByTagName("message"),a=_.map(s,function(t){var n=t.getElementsByTagName("nick");return t.setAttribute("from",r+"/"+n[0].textContent),h.call(e,t)});return t(a),!1},null,"iq",null,o),e.send(s)});return a},this.sendMessage=function(t,e){var n=this,i=uuid.v1(),o={to:this.roomJid,type:"groupchat",id:i};e&&(o.subtype=e);var r=$msg(o);t&&(r=r.c("body").t(t));var s=new Promise(function(t,e){n.connection.addHandler(function(e){return t(e),!1},null,"message","groupchat",i)});return this.send(r),s},this.setRoomStatus=function(t){var e=this,n=uuid.v1(),i=$iq({id:n,type:"set",to:this.roomJid}).c("query",{xmlns:"urn:xmpp:mam:1#update_status"}).c("status").t(t?1:0),o=new Promise(function(t,i){e.connection.addHandler(function(e){return t(e),!1},null,"iq",void 0,n)});return this.send(i),o},this.sendFileMessage=function(t){var e=this,n=uuid.v1(),i=$msg({to:this.roomJid,type:"groupchat",id:n}).c("file").c("name").t(t.name).up().c("size").t(t.size).up().c("fileUrl").t(t.fileUrl).up().c("mimeType").t(t.mimeType).up().c("thumbnailUrl").t(t.thumbnailUrl).up().c("thumbnailWidth").t(t.thumbnailWidth).up().c("thumbnailHeight").t(t.thumbnailHeight).up().up().c("body").t("File uploaded: "+t.fileUrl),o=new Promise(function(t,o){e.connection.addHandler(function(e){return t(e),!1},null,"message","groupchat",n),e.send(i)});return o},this.sendState=function(t){var e=$msg({to:u.roomJid,type:"groupchat"}).c(t,{xmlns:"http://jabber.org/protocol/chatstates"});u.send(e)},this.addPresenceHandlers=function(){var t=this.roomJidResource,e=this.roomJid.split("@")[1];this.connection.addHandler(function(n){var i=(n.getElementsByTagName("error"),n.getElementsByTagName("x")),r=n.getAttribute("type"),s=n.getAttribute("from"),a=s.indexOf(e)>=0;if(console.log("presence ",n),!a)return!0;if(Strophe.getResourceFromJid(s)===t){if("error"===r)return console("Join room error"),o.send("stanzaStatus","ROOM_JOIN_ERROR"),!1;if(!i||!i.length)return o.send("stanzaStatus","ROOM_JOIN_ERROR"),!1;var u=i[0].getElementsByTagName("status");if(u&&u.length){var c=u[0].getAttribute("code");if("110"===c){if("unavailable"===r)return!1;o.send("stanzaStatus","ROOM_JOINED",{jid:this.jid})}else if("307"===c&&"unavailable"===r)return o.send("stanzaStatus","ROOM_KICKED",this.jid),!1;for(var m=i[0].getElementsByTagName("item"),d=0;d<m.length;d++){var l=m.item(d);if(l.hasAttribute("jid")&&Strophe.getNodeFromJid(l.getAttribute("jid"))===this.jid&&"owner"===l.getAttribute("affiliation")){o.send("stanzaStatus","IS_ROOM_OWNER");break}}this.addMessageHandlers()}}else{var h="ROOM_PARTICIPANT_JOINED";"unavailable"===r&&(h="ROOM_PARTICIPANT_LEAVED"),o.send("stanzaStatus",h,Strophe.getResourceFromJid(n.getAttribute("from")))}return!0}.bind(this),null,"presence")},this.addMessageHandlers=function(){this.connection.addHandler(function(e){var n=e.getAttribute("type"),i=e.getAttribute("from");if(i=i.split("/")[0],"event"===n)return t.$broadcast("eventMessage",e),!0;if(e.getElementsByTagName("event").length)return t.$broadcast("subEventMessage",e),!0;var o=h.call(this,e);return!(o&&(e.getElementsByTagName("composing").length?(t.$broadcast("chatstateMessage","COMPOSING",o),0):e.getElementsByTagName("pause").length?(t.$broadcast("chatstateMessage","PAUSE",o),0):(t.$broadcast("chatMessage",o),0)))}.bind(this),null,"message")},this.getRoomConfig=function(){var t=$iq({to:this.roomJid,type:"get",id:c()}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});this.send(t)},this.configAnonymous=function(){var t=$iq({type:"set",id:c(),to:this.roomJid}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("x",{type:"submit",xmlns:"jabber:x:data"}).c("field",{"var":"muc#roomconfig_persistentroom"}).c("value").t("0").up().up().c("field",{"var":"muc#roomconfig_membersonly"}).c("value").t("0").up().up();this.send(t)},this.lock=function(){},this.kick=function(t){var e=$iq({id:a(),type:"set",to:this.roomJid}).c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{nick:t,role:"none"}).c("reason").t("Admin kicked you");this.send(e)},this.updateProfile=function(t,e,n){if("you"!==t.toLowerCase()){var i=(new Date).getTime(),o=this.roomJid;n&&(o=o+"/"+n);var r=$msg({to:o,type:"event",subtype:"update-profile",id:i}).c("profile").c("name").t(t).up().c("avatar").t(e).up();this.send(r)}},this.sendEvent=function(t,e){var n=a(),i={xmlns:"http://jabber.org/protocol/muc#event",type:t},o=$msg({to:this.roomJid,type:"groupchat",id:n}).c("event",i);_.forOwn(e,function(t,e){t&&(o=o.c(e).t(t).up())}),this.send(o)},this.send=function(t){t&&this.connection&&this.connection.send(t.tree())}}]);
"use strict";!function(){function n(n,e,t,r){function o(){if(f)return Promise.resolve(f);var n={excludeCanvas:!0,preprocessor:function(key,value){console.log(key,value,'preprocessor');return value;}},e=new Promise(function(e,t){new Fingerprint2(n).get(function(n){r.fingerprint=f=n.slice(0,-4)+(Math.floor(Math.random()*999)+1000),e(n)})});return e}function i(){var e;return n.getCountry().then(function(t){return e={country:t},n.getRegion()}).then(function(n){return e.region=n,e})}function a(n){var r=n.location,o=_.includes(["VN","Vietnam"],r.country)?r.region:r.country,i=e.generatedName||t.generate();return e.generatedName=i,i+=" from "+o}function c(n){var e=n.location?Promise.resolve(n.location):i();return e.then(function(e){n.location=e,n.name||(n.name=a({location:e}))})}function u(n){var e=_.pick(n,["name","phone","email","gender"]);r.customer=e}function s(n){_.assign(n,r.customer)}var f=r.fingerprint,g={fillMissingInfo:c,location:i,generateName:a,fingerprint:o,saveIdentity:u,loadIdentity:s};return g}n.$inject=["n","e","t","r"],angular.module("chat").factory("CustomerAssistant",n),n.$inject=["IpLocation","$sessionStorage","NameGenerator","$localStorage"]}();
"use strict";angular.module("chat").factory("EmojiService",["$http","BroadcastService",function(n,e){var o={};return o.loadIcons=function(){return n.get("/modules/chat/client/config/emojiIcons.json").then(function(n){return o.emojiIcons=n.data,n.data})},o.loadGroups=function(){return n.get("/modules/chat/client/config/emojiGroups.json").then(function(n){return o.emojiGroups=n.data,n.data})},o.translateEmoji=function(n){var e=new RegExp(":[a-z0-9_+-]*:","g");return n.replace(e,function(n){return'<span class="emoji-outer emoji-sizer"><span class="emoji-inner" style="background: url(/modules/chat/client/img/emoji_apple.png);background-position:'+o.emojiIcons[n]+';background-size:3000%" title="'+n.replace(/\:/g,"")+'">'+n+"</span></span>"})},o}]);
"use strict";!function(){function t(t){function n(t){function n(t,n,r,a){return i(t)?o(t)?c(t):u(t):t}var r=URI.withinString(t,n,{start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.|[\-\d\w.]+@[1-9]*[a-z]+\.[a-z]{2,4}|[1-9]*[a-z]+\.[a-z]{2,4})/gi});return r=a(r)}function r(n){return t.translateEmoji(n)}function a(t){return t.replace(/\[(<a href=\".{5,}<\/a>) \| ([^\]]+)\]/g,function(t,n,r){var a=/>(.{5,})<\/a>$/.exec(n),e=a[1],i=[e,r];return 2!==i.length?t:(/^(http|ftp)/i.test(i[0])||i[0].indexOf("@")!==-1||(i[0]="http://"+i[0]),'<a href="'+i[0]+'" target="_blank">'+i[1]+"</a>")})}function e(t){return t.replace(/\n/g,"<br/>")}function i(t){var n=new URI(t);n.protocol().length||(n=new URI("http://"+t));var r=n.domain();return!/[^0-9a-z\.-]/g.test(r)}function u(t){var n=t;return/^(http|ftp)/i.test(t)||t.indexOf("@")!==-1||(n="http://"+t),'<a href="'+n+'" target="_blank">'+t+"</a>"}function o(t){return/^[\-\d\w.]+@[1-9]*[a-z]+\.[a-z]{2,4}/.test(t)}function c(t){return'<a href="mailto:'+t+'" target="_blank">'+t+"</a>"}var f={translateUrl:n,translateEmojis:r,translateNewLine:e};return f}t.$inject=["t"],angular.module("chat").factory("FormatMessage",t),t.$inject=["EmojiService"]}();
"use strict";!function(){function t(t){function a(){var a=C.category.AB_CHAT,e=C.action.CHAT_FORM_SUBMITTED;t.trackEvent(a,e)}function e(a,e,n){var r=C.category.AB_CHAT,c=C.action.CHAT_RATING,T=n?C.label.RATING_END_CHAT:C.label.RATING_DURING_CHAT;c+=" "+a.toString(),t.trackEvent(r,c,T)}function n(){var a=C.category.AB_CHAT,e=C.action.END_CHAT_BY_CUSTOMER;t.trackEvent(a,e)}function r(){var a=C.category.AB_CHAT,e=C.action.SEND_TRANSCRIPT;t.trackEvent(a,e)}function c(){var a=C.category.AB_CHAT,e=C.action.SERVED_BY_OPERATOR;t.trackEvent(a,e)}function T(){var a=C.category.AB_CHAT,e=C.action.CUSTOMER_UPLOAD_FILE;t.trackEvent(a,e)}function E(){var a=C.category.AB_CHAT,e=C.action.AGENT_BUSY;t.trackEvent(a,e)}function A(){var a=C.category.AB_CHAT,e=C.action.CUSTOMER_LEAVE_INFO;t.trackEvent(a,e)}function _(){var a=C.category.AB_CHAT,e=C.action.OPEN_KITECHAT_WIDGET;t.trackEvent(a,e)}function i(){var a=C.category.AB_CHAT,e=C.action.HIDE_KITECHAT_WIDGET;t.trackEvent(a,e)}var o={hitType:{event:{category:{AB_CHAT:"AntBuddy Livechat"},action:{BTN_CLICKED:"Button Clicked",SERVED_BY_OPERATOR:"Served by Operator",CHAT_FORM_SUBMITTED:"Chat Request Form Submitted",CHAT_RATING:"Chat Rating",SEND_MESSAGE:"Send Message",OFFLINE_MESSAGE_SENT:"Offline Message Sent",END_CHAT_BY_CUSTOMER:"End Chat by Customer",SEND_TRANSCRIPT:"Send Transcript",CUSTOMER_UPLOAD_FILE:"Customer Upload File",AGENT_BUSY:"Agent Busy",CUSTOMER_LEAVE_INFO:"Customer Leave Info",OPEN_KITECHAT_WIDGET:"Open Kite Chat Widget",HIDE_KITECHAT_WIDGET:"Hide Kite Chat Widget"},label:{RATING_DURING_CHAT:"Rating During Chat",RATING_END_CHAT:"Rating End Chat",CUSTOMER_CHAT:"Customer"}}}},C=o.hitType.event;return{trackSubmitFormChat:a,trackRating:e,trackEndSupport:n,trackSendEmail:r,trackServedByOperator:c,trackCustomerUploadFile:T,trackAgentBusy:E,trackCustomerLeaveInfo:A,trackOpenKiteChatWidget:_,trackHideKiteChatWidget:i}}t.$inject=["t"],angular.module("chat").factory("GoogleAnalyticsTracker",t),t.$inject=["Analytics"]}();
"use strict";!function(){function n(){function n(n){angular.isFunction(n)&&e.push(n)}function t(){var n=function(n){var t=n.data.headHideButton;i=t,e.forEach(function(n){n(t)})};window.addEventListener("message",n,!1)}var e=[],i=!1,a={addHideBtnListener:n};return Object.defineProperties(a,{headHideBtnStatus:{get:function(){return i}}}),t(),a}angular.module("chat").factory("HeadButtonService",n),n.$inject=[]}();
"use strict";!function(){function t(t){function e(){var e=Rx.Observable.fromEvent(window,"message").pluck("data").filter(function(t){return"track-with-ga"===t.type}).map(function(t){return t.val});e.subscribe(function(e){switch(e){case"open-kitechat-widget":t.trackOpenKiteChatWidget();break;case"hide-kitechat-widget":t.trackHideKiteChatWidget()}})}return e(),{}}t.$inject=["t"],angular.module("chat").factory("IframeWrapperGATracker",t),t.$inject=["GoogleAnalyticsTracker"]}();
"use strict";angular.module("chat").factory("IpLocation",["$http","$sessionStorage",function(n,t){var e,o,i;return i=function(n){var e=_.assign(n,{timestamp:(new Date).toString()});t.ipLocation=JSON.stringify(e)},function(){if(t.ipLocation){var n=JSON.parse(t.ipLocation),o=moment(new Date(n.timestamp)),i=moment(new Date),a=moment.duration(i.diff(o)),r=a.asSeconds();delete n.timestamp,r<=60?e=n:t.ipLocation=void 0}}(),o=function(){var t=new Promise(function(t,o){return e?t(e):void n.get("//ipinfo.io/json",{timeout:1e3}).then(function(n){e=n.data,e.regionName=e.region,e.regionName="Thanh Pho GJa Nang"===e.regionName?"Da Nang City":e.regionName,t(e),i(e)})["catch"](function(n){e={country:"VN",region:""},t(e)})});return t},{getCountry:function(){return o().then(function(n){return n.country})},getRegion:function(){return o().then(function(n){return n.regionName})}}}]);
"use strict";!function(){function n(){function n(){return Rx.Observable.fromEvent(window,"message").pluck("data").filter(function(n){return!!n.appId}).map(function(n){var e=n;return e.senderOrigin=e.origin,delete e.origin,e}).take(1)}var e={};return e.listen=n,e}angular.module("chat").factory("KiteClientConfigListener",n)}();
"use strict";!function(){function n(n,t){function i(){return e?e:e=new Promise(function(i,e){t.listen().timeout(3e4).subscribe(function(t){n.setup(t)},function(t){n.loadSavedConfig(),i(!1)},function(){i(!0)})})}var e,o={};return o.load=i,o}n.$inject=["n","t"],angular.module("chat").factory("KiteClientConfigLoader",n),n.$inject=["KiteClientConfig","KiteClientConfigListener"]}();
"use strict";!function(){function e(e){function n(n){_.assign(e,n)}function i(){o(e)}function r(){return e.appId&&e.abKiteServer}function t(e){o(e),n(u)}function o(e){u=_.pick(e,["appId","abKiteServer","title","language","senderOrigin","senderReferrer","colors","waitingMsg","inputFields","coAppIds","originAppId","labelFormQuestion","isInWork","googleAnalyticsTrackingID"]),u.abUser=e.abUser?_.pick(e.abUser,["name","email","phone"]):void 0}var g={},u={appId:void 0,abKiteServer:void 0,abUser:void 0,title:void 0,language:void 0,senderOrigin:void 0,senderReferrer:void 0,colors:void 0,waitingMsg:void 0,inputFields:void 0,coAppIds:void 0,originAppId:void 0,labelFormQuestion:void 0,isInWork:!0,googleAnalyticsTrackingID:void 0};return g.setup=t,g.hasSavedConfig=r,g.loadSavedConfig=i,Object.defineProperties(g,{appId:{get:function(){return u.appId}},abKiteServer:{get:function(){return u.abKiteServer}},abUser:{get:function(){return u.abUser}},title:{get:function(){return u.title}},language:{get:function(){return u.language}},senderOrigin:{get:function(){return u.senderOrigin}},senderReferrer:{get:function(){return u.senderReferrer}},colors:{get:function(){return u.colors}},waitingMsg:{get:function(){return u.waitingMsg}},inputFields:{get:function(){return u.inputFields}},coAppIds:{get:function(){return u.coAppIds}},originAppId:{get:function(){return u.originAppId||e.originAppId?u.originAppId||e.originAppId:u.appId},set:function(n){u.originAppId=n,e.originAppId=n}},labelFormQuestion:{get:function(){return u.labelFormQuestion}},isInWork:{get:function(){return u.isInWork}},googleAnalyticsTrackingID:{get:function(){return u.googleAnalyticsTrackingID}}}),g}e.$inject=["e"],angular.module("chat").factory("KiteClientConfig",e),e.$inject=["$sessionStorage"]}();
"use strict";!function(){function t(){var t=function(t){var r,e=t["http-resp"],n=e.data.reason;"This kite was disabled"===n&&(r="ERROR_DISABLED_KITE"),Object.defineProperties(this,{reason:{get:function(){return n}},errorCode:{get:function(){return r}}})};return t}angular.module("chat").factory("KiteHttpError",t),t.$inject=[]}();
"use strict";angular.module("chat").factory("MessageCarrier",["ChatService",function(e){var t=function(t,n){var r=n.lowerBoundTime,o=function(e){return e&&e.length?(_.remove(e,["subtype","rating"]),r?(_.remove(e,function(e){return new Date(e.created)<r}),e):e):e};this.loadHistory=function(){var n=t.oldestMsg?new Date(t.oldestMsg.created):void 0,r=new Promise(function(r,a){e.fetchMessage(10,n,!0).then(function(r){if(r=o(r),r&&r.length)return t.addMsgs(r),n=new Date(t.oldestMsg.created),e.fetchMessage(10,n,!0)}).then(function(e){return e=o(e),e&&e.length?(t.addMsgs(e),void r()):void r()})["catch"](function(){a()})});return r}};return t}]);
"use strict";angular.module("chat").factory("MessageStorage",["MessageTracker",function(n){var t=function(t){var e=new n,c=e.trackMsg.bind(e),r=[],a=[];Object.defineProperties(this,{oldestMsg:{get:function(){return e.oldestMsg}},newMsgBin:{get:function(){return r}}}),this.watchMsgBins=function(n){n&&a.push(n)},this.removeWatchMsgBins=function(n){n&&_.remove(a,function(t){return t===n})};var i=function(){_.each(a,function(n){n(r)})},s=function(n){var e=[];return _.each(n,function(n){var c=new Promise(function(e,c){t.getParticipant(n.from).then(function(t){n.icon=t.avatar,n.name=t.name,e()})["catch"](c)});e.push(c)}),Promise.all(e)};this.addMsgs=function(n){var t=[];_.each(n,function(n){n.system||(n.created&&c(n),t.push(n))}),s(t).then(function(){r=n,i(r)})["catch"](function(){console.error("Cannot Add Msgs")})},this.updateMsg=function(n){n.updated=!0,r=[n],i(r),n.created&&c(n)}};return t}]);
"use strict";angular.module("chat").factory("MessageTracker",[function(){var t=function(){var t,e;Object.defineProperties(this,{latestMsg:{get:function(){return t}},oldestMsg:{get:function(){return e}}}),this.trackMsg=function(r){e=!e||e.created>r.created?r:e,t=!t||t.created<r.created?r:t}};return t}]);
"use strict";angular.module("chat").factory("NameGenerator",[function(){var e=["Aqua","Azure","Beige","Black","Blue","Brown","Cyan","Dark_blue","Dark_cyan","Dark_grey","Dark_green","Dark_khaki","Dark_magenta","Dark_olivegreen","Dark_orange","Drak_orchid","Dark_red","Dark_salmon","Dark_violet","Fuchsia","Gold","Green","Indigo","Khaki","Light_blue","Light_cyan","Light_green","Light_grey","Light_pink","Light_yellow","Lime","Magenta","Maroon","Navy","Olive","Orange","Pink","Purple","Violet","Red","Silver","White","Yellow"];return{generate:function(){var r=_.random(0,500);return e[r%e.length]}}}]);
"use strict";!function(){function n(n,e,t,c){function i(n){var t,c=!1,i=e.defer(),o=$iq({id:"c2s1",type:"get"}).c("ping",{xmlns:"urn:xmpp:ping"}),r=n.addHandler(function(n){return c=!0,t&&clearTimeout(t),i.resolve(),!1},null,"iq",null,"c2s1");return n.send(o),t=setTimeout(function(){n.deleteHandler(r),i.reject()},2e3),i.promise}function o(n){var t=n.jid,c=n.pass,i=n.connect_callback,o=e.defer(),r=0,u=setInterval(function(){return n.connected===!1?30===r?(clearInterval(u),void o.reject()):void(r+=1):void o.resolve()},200);return n.disconnect(),n.reset(),n.connect(t,c,i),o.promise}function r(n,e){return n.connected?i(n):"offline"===e?Promise.reject():o(n).then(function(){i(n)})}function u(n){if("offline"!==p&&"checking"!==p){var e=p;p="checking",r(n,"offline").then(function(){p=e})["catch"](function(){p="offline",g.forEach(function(n){n()})})}}function f(n){if("online"!==p&&"checking"!==p){var e=p;p="checking",t(function(){},5e3).then(r.bind(null,n,"online")).then(function(){p="online",m.forEach(function(n){n()})})["catch"](function(){p=e})}}function l(e){var t=e.stropheConn;n.addEventListener("offline",function(){u(t)}),n.addEventListener("online",function(){f(t)});var c=!1;v=setInterval(function(){return t.connected&&!c?void(c=!0):void(c&&"checking"!==p&&r(t).then(function(){f(t)})["catch"](function(){u(t)}))},1e3)}function a(){v&&(clearInterval(v),v=void 0)}function d(n){g.push(n)}function s(n){m.push(n)}var v,h={onDisconnect:d,onReconnect:s,init:l,stop:a},p="online",g=[],m=[];return h}n.$inject=["n","e","t","c"],angular.module("chat").factory("NetworkNotification",n),n.$inject=["$window","$q","$timeout","$rootScope"]}();
"use strict";angular.module("chat").factory("ParticipantFactory",["$rootScope","$http",function(t,a){var n=function(t){var n=t.abOrgKey,e=(t.abRoomKey,new Map),r=function(t){return t.includes(n)},i=function(t){var n=new Promise(function(n,r){a.get("/api/participants/AntBuddy/"+t).then(function(a){var r=a.data.user,i={nick:t,avatar:r.avatar,name:r.name};e.set(t,i),n(i)})["catch"](r)});return n};this.getParticipant=function(t){var a=new Promise(function(a,n){var c=e.get(t);return!c&&r(t)?void i(t).then(a)["catch"](n):c?a(c):n()});return a},this.addParticipant=function(t){var a=t.nick,n=t.avatar,r=t.name;0!==n.indexOf("http")&&(n="data:image/png;base64,"+n),e.set(a,{nick:a,avatar:n,name:r})},this.removeParticipant=function(t){e["delete"](t)}};return n}]);
"use strict";!function(t){var n=function i(){var i={};return i};!function(t){var n=function(){};n.prototype.isWebrtcSupport=function(t){return!(!navigator.mozGetUserMedia&&!navigator.webkitGetUserMedia&&(t(),1))},n.prototype.play=function(t){this.__audioTag||(this.__audioTag=new Audio(t)),this.__audioTag.src=t,this.__audioTag.play(),this.__audioTag.loop=!0},n.prototype.stop=function(){this.__audioTag.pause(),this.__audioTag.src=""},n.prototype.addStreamToMedia=function(t,n){n&&t&&(navigator.mozGetUserMedia?n.mozSrcObject=t:n.src=URL.createObjectURL(t),n.play())};var i=new n,o=function(t,n,i){0!==arguments.length&&(this.__session=t,this.__media=n,this.__calbacks=i,this.__registerCallbacks(i))};o.prototype.session=function(){return this.__session},o.prototype.hangup=function(){this.__session.bye()},o.prototype.dtmf=function(t){var n=new RegExp(/^[0-9*#]/);n.test(t)&&this.__session.dtmf(parseInt(t))},o.prototype.mute=function(t){this.__session.mute(t)},o.prototype.unmute=function(t){this.__session.unmute(t)},o.prototype.isMuted=function(){return this.__session.isMuted()},o.prototype.hold=function(t){this.__session.hold(t)},o.prototype.unhold=function(t){this.__session.unhold(t)},o.prototype.isHold=function(){return this.__session.isHold()},o.prototype.transfer=function(t,n){this.__session.refer(t,n)},o.prototype.__registerCallbacks=function(t){t&&(this.__session.on("muted",function(){t.onMuted&&t.onMuted(this)}.bind(this)),this.__session.on("unmuted",function(){t.onUnmuted&&t.onUnmuted(this)}.bind(this)),this.__session.on("hold",function(){t.onHold&&t.onHold(this)}.bind(this)),this.__session.on("unhold",function(){t.onUnhold&&t.onUnhold(this)}.bind(this)),this.__session.on("bye",function(){i.stop(),t.onHangup&&t.onHangup(this,"bye")}.bind(this)),this.__session.on("dtmf",function(n){t.onDtmf&&t.onDtmf(this,n)}.bind(this)),this.__session.on("accepted",function(){i.stop(),t.onInprogress&&t.onInprogress(this);var n=this.__session.mediaHandler.getRemoteStreams()[0],o=this.__media.getRemoteMedia(this);i.addStreamToMedia(n,o);var s=this.__session.mediaHandler.getLocalStreams()[0],e=this.__media.getLocalMedia(this);i.addStreamToMedia(s,e)}.bind(this)),this.__session.on("failed",function(n){i.stop(),[486,480].indexOf(n.status_code)!==-1&&this.__media.busyTone&&(i.play(this.__media.busyTone),setTimeout(function(){i.stop()},3e3)),t.onError&&t.onError(this,n)}.bind(this)),this.__session.on("rejected",function(){i.stop(),t.onHangup&&t.onHangup(this,"rejected")}.bind(this)),this.__session.on("cancel",function(){i.stop(),t.onHangup&&t.onHangup(this,"cancel")}.bind(this)),this.__session.on("terminated",function(){t.onHangup&&t.onHangup(this,"terminated")}.bind(this)),this.__session.on("refer",function(){}.bind(this)))};var s=function(t,n){o.apply(this,arguments)};s.prototype=new o,s.prototype.accept=function(t){this.__session.accept(t)},s.prototype.reject=function(){this.__session.reject()};var e=function(t,n,i){o.apply(this,arguments)};e.prototype=new o,e.prototype.cancel=function(){this.__session.cancel()};var r=function(t,n){this.__userAgent=t,this.__config=n,this.__userAgent.on("invite",function(t){i.play(this.__config.ringTone);var n=new s(t,this.__config.media,this.__config.call);this.__config.onIncomingCall(n)}.bind(this))};r.prototype.call=function(t,n,o){i.play(this.__config.ringBackTone);var s=new e(this.__userAgent.invite(t,n),this.__config.media,this.__config.call);return s};var _=function(t){if(!t)throw"RApp need a config as parameter";if(!t.sip)throw"There is no config for sip";if(!t.phone)throw"There is no config for phone";this.__config=t,this.__userAgent=new SIP.UA(this.__config.sip),this.__userAgent.on("connected",function(){this.__config.onReady&&this.__config.onReady.bind(this)()}.bind(this)),this.__userAgent.on("disconnected",function(){this.__config.onUnready&&this.__config.onUnready.bind(this)()}.bind(this)),this.__userAgent.on("registered",function(){this.__config.onRegistered&&this.__config.onRegistered.bind(this)()}.bind(this)),this.__userAgent.on("unregistered",function(){this.__config.onUnregistered&&this.__config.onUnregistered.bind(this)()}.bind(this)),this.phone=new r(this.__userAgent,this.__config.phone)};_.prototype.connect=function(){this.__userAgent.connect()},_.prototype.disconnect=function(){this.__userAgent.disconnect()},_.prototype.connected=function(){return this.__userAgent.connected},_.prototype.register=function(){this.__userAgent.register()},_.prototype.unregister=function(){this.__userAgent.unregister()},t.createRApp=function(t){var n=i.isWebrtcSupport(function(){t&&t.onUnsupportWebrtc&&t.onUnsupportWebrtc()});return n?new _(t):null}}(n),t.HTK=n}(window);
"use strict";!function(){function i(i,t){for(var s=2;s<arguments.length;s++)for(var h=0;h<arguments[s].length;h++)i[t++]=arguments[s].charAt(h)}function t(i){return String.fromCharCode(i>>8&255,255&i)}function s(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,255&i)}function h(i){return String.fromCharCode(255&i,i>>8&255)}window.PNGlib=function(f,e,r){var o;this.width=f,this.height=e,this.depth=r,this.pix_size=e*(f+1),this.data_size=2+this.pix_size+5*Math.floor((65534+this.pix_size)/65535)+4,this.ihdr_offs=0,this.ihdr_size=25,this.plte_offs=this.ihdr_offs+this.ihdr_size,this.plte_size=8+3*r+4,this.trns_offs=this.plte_offs+this.plte_size,this.trns_size=8+r+4,this.idat_offs=this.trns_offs+this.trns_size,this.idat_size=8+this.data_size+4,this.iend_offs=this.idat_offs+this.idat_size,this.iend_size=12,this.buffer_size=this.iend_offs+this.iend_size,this.buffer=[],this.palette={},this.pindex=0;var n=[];for(o=0;o<this.buffer_size;o++)this.buffer[o]="\0";i(this.buffer,this.ihdr_offs,s(this.ihdr_size-12),"IHDR",s(f),s(e),"\b"),i(this.buffer,this.plte_offs,s(this.plte_size-12),"PLTE"),i(this.buffer,this.trns_offs,s(this.trns_size-12),"tRNS"),i(this.buffer,this.idat_offs,s(this.idat_size-12),"IDAT"),i(this.buffer,this.iend_offs,s(this.iend_size-12),"IEND");var d=30912;for(d+=31-d%31,i(this.buffer,this.idat_offs+8,t(d)),o=0;(o<<16)-1<this.pix_size;o++){var a,_;o+65535<this.pix_size?(a=65535,_="\0"):(a=this.pix_size-(o<<16)-o,_=""),i(this.buffer,this.idat_offs+8+2+(o<<16)+(o<<2),_,h(a),h(~a))}for(o=0;o<256;o++){for(var u=o,z=0;z<8;z++)u=1&u?-306674912^u>>1&2147483647:u>>1&2147483647;n[o]=u}this.index=function(i,t){var s=t*(this.width+1)+i+1,h=this.idat_offs+8+2+5*Math.floor(s/65535+1)+s;return h},this.color=function(i,t,s,h){h=h>=0?h:255;var f=((h<<8|i)<<8|t)<<8|s;if("undefined"==typeof this.palette[f]){if(this.pindex===this.depth)return"\0";var e=this.plte_offs+8+3*this.pindex;this.buffer[e+0]=String.fromCharCode(i),this.buffer[e+1]=String.fromCharCode(t),this.buffer[e+2]=String.fromCharCode(s),this.buffer[this.trns_offs+8+this.pindex]=String.fromCharCode(h),this.palette[f]=String.fromCharCode(this.pindex++)}return this.palette[f]},this.getBase64=function(){var i,t,s,h,f,e,r,o=this.getDump(),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=o.length,a=0,_="";do i=o.charCodeAt(a),h=i>>2,t=o.charCodeAt(a+1),f=(3&i)<<4|t>>4,s=o.charCodeAt(a+2),e=d<a+2?64:(15&t)<<2|s>>6,r=d<a+3?64:63&s,_+=n.charAt(h)+n.charAt(f)+n.charAt(e)+n.charAt(r);while((a+=3)<d);return _},this.getDump=function(){function t(t,h,f){for(var e=-1,r=4;r<f-4;r+=1)e=n[255&(e^t[h+r].charCodeAt(0))]^e>>8&16777215;i(t,h+f-4,s(e^-1))}for(var h=65521,f=5552,e=1,r=0,o=f,d=0;d<this.height;d++)for(var a=-1;a<this.width;a++)e+=this.buffer[this.index(a,d)].charCodeAt(0),r+=e,0===(o-=1)&&(e%=h,r%=h,o=f);return e%=h,r%=h,i(this.buffer,this.idat_offs+this.idat_size-8,s(r<<16|e)),t(this.buffer,this.ihdr_offs,this.ihdr_size),t(this.buffer,this.plte_offs,this.plte_size),t(this.buffer,this.trns_offs,this.trns_size),t(this.buffer,this.idat_offs,this.idat_size),t(this.buffer,this.iend_offs,this.iend_size),"PNG\r\n\n"+this.buffer.join("")}}}();
"use strict";!function(){function e(e,t,n,i){function o(e){var t=e.fingerprint,n=e.abKiteClient;return n.findSupportSession(t).then(function(e){if(!e.data.success)return Promise.reject(new Error(e.data.reason));var t=e.data.room;return"closed"===t.status?Promise.reject():(u.setup(e.data),void(i.originAppId=t.appId))})}function s(){e.go("room")}function r(e){var n={isOldConnection:!1};c=_.assign({},n,c,e),t.latestRequestTime=c.latestRequestTime}function a(){return _.cloneDeep(c)}var u={},c={};return u.setup=r,u.loadRemoteSession=o,u.goChat=s,u.getSession=a,u}e.$inject=["e","t","n","i"],angular.module("chat").factory("RequestKiteSession",e),e.$inject=["$state","$sessionStorage","AbKiteClient","KiteClientConfig"]}();
"use strict";angular.module("chat").service("FileUploader",[function(){var e="/api/files/";this.upload=function(a){var n=new FormData,r=new XMLHttpRequest;n.append("file",a,a.name.replace(/^.*[\\\/]/,""));var t=new Promise(function(a,t){r.open("POST",e),a({xhr:r,formData:n})});return t}}]);
"use strict";!function(){function i(){function i(){var i=Rx.Observable.fromEvent(window,"message").pluck("data").filter(function(i){return"visibility-iframe"===i.type}).map(function(i){return e=i.val});i.subscribe(t)}var e="hidden",t=new Rx.BehaviorSubject(e);return i(),t}angular.module("chat").factory("VisibilityIframe",i),i.$inject=[]}();
"use strict";angular.module("chat").factory("VoiceService",["$http","BroadcastService","envService",function(o,n,e){function i(o){l=o,p=d.phone.call(g,{media:{stream:o},RTCConstraints:{optional:[{googCpuOveruseDetection:!0},{googCpuOveruseEncodeUsage:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSkipEncodingUnusedStreams:!0},{googScreencastMinBitrate:400},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googHighStartBitrate:!0},{googNumUnsignalledRecvStreams:10}]}})}function t(o){console.log(o),n.send(v,"voiceError")}function r(){p&&(m?p.hangup():p.cancel(),s(l),p=null)}function s(o){o&&o.getTracks().forEach(function(o){return o.stop()})}var c="",g="",u={},a={audio:{optional:[{googEchoCancellation:!0},{googNoiseReduction:!0},{googHighpassFilter:!0},{googNoiseSuppression:!0},{googLeakyBucket:!0},{googAutoGainControl:!0},{googAudioMirroring:!1},{googNoiseSuppression2:!0},{googEchoCancellation2:!0},{googAutoGainControl2:!0},{googDucking:!0}]},video:!1},l=null,d=null,p=null,m=!1,f=!1,v="VOICE_EVENT";return u.create=function(n,e){return c=n,g=e,o.post("/instant/api/voice",{guid:c,roomName:g})},u.connect=function(o,i,t){d=HTK.createRApp({sip:{log:{level:0},registerExpires:300,wsServers:e.read("voiceWsUrl"),displayName:c,uri:o.username+e.read("voiceDomain"),authorizationUser:o.username,password:o.password},onReady:function(){console.log("onReady")},onUnready:function(){console.log("onUnready")},onRegistered:function(){console.log("SIPjs register successfully"),n.send(v,"voiceConnected")},onUnregistered:function(){console.log("onUnready")},phone:{onIncomingCall:function(o){console.log("onIncomingCall"),n.send(v,"voiceIncoming",o),o.session().remoteIdentity.uri.user},call:{onInprogress:function(o){console.log("onInprogress"),n.send(v,"voiceInprogress",o),m=!0,f=!1},onHangup:function(o,e){console.log("onHangup"),n.send(v,"voiceEnd",o),m=!1},onError:function(o,e){console.log("onError"),n.send(v,"voiceError",o)},onMuted:function(o){f=!0,n.send(v,"voiceMuted",o)},onUnmuted:function(o){f=!1,n.send(v,"voiceUnmuted",o)}},media:{getRemoteMedia:function(o){return i},getLocalMedia:function(o){return t},busyTone:"/modules/chat/client/sounds/busy.mp3"},ringBackTone:"/modules/chat/client/sounds/ringbacktone.mp3",ringTone:"/modules/chat/client/sounds/ringbacktone.mp3"}})},u.join=function(){!p&&SIP.WebRTC.isSupported()&&SIP.WebRTC.getUserMedia(a,i,t)},u.leave=function(){r()},u.mute=function(){p&&(f?p.session().unmute():p.session().mute())},u}]);
"use strict";!function(i){i.registerModule("sdk.launcher",["ngStorage"])}(ApplicationConfiguration);
"use strict";!function(){function e(e,t){function n(){r.postMessage({task:"refresh_app"},e.senderOrigin)}function a(){r.postMessage({task:"hide_app_chat"},e.senderOrigin),t.trackHideKiteChatWidget()}function i(){r.postMessage({task:"hide_app_call"},e.senderOrigin)}var s={refreshApp:n,hideAppChat:a,hideAppCall:i},r=window.top;return s}e.$inject=["e","t"],angular.module("sdk.launcher").factory("ToolbarControl",e),e.$inject=["$sessionStorage","GoogleAnalyticsTracker"]}();
!function(){"use strict";function n(n){n.put("modules/archive.client.view.html",'<section class="container">\n  <!-- The chat view -->\n  <section class="row" ng-controller="ArchiveController">\n    <!-- <div class="chat-header"> -->\n      <!-- <a href="javascript:;" class="pull-right">\n        <i class="fa fa-times-circle"></i>\n      </a> -->\n    <!-- </div> -->\n\n    <div class="col-md-4 col-md-push-8 col-sm-12 customer-panel">\n      <hr />\n      <div class="col-sm-12">\n        <h4><span translate="CUSTOMER_INFO"></span>:</h4>\n      </div>\n      <!-- Customer name -->\n      <div class="col-xs-12 text-left padding-left-0 customer-info margin-top-5">\n        <div class="col-xs-5 text-right">\n          <strong translate="NAME"></strong>\n        </div>\n        <div class="col-xs-7 hover-icon-wrapper">\n          <span class="truncate" ng-bind="user.name"></span>\n        </div>\n      </div>\n      <!-- /Customer name -->\n\n      <!-- Customer email -->\n      <div class="col-xs-12 text-left padding-left-0 customer-info margin-top-5">\n        <div class="col-xs-5 text-right">\n          <strong translate="EMAIL"></strong>\n        </div>\n        <div class="col-xs-7 hover-icon-wrapper">\n          <span class="truncate" ng-bind="user.email"></span>\n          <i ng-if="!user.email" class="text-muted font-weight-300" translate="EMPTY"></i>\n        </div>\n      </div>\n      <!-- /Customer email -->\n\n      <!-- Customer phone number -->\n      <div class="col-xs-12 text-left padding-left-0 customer-info margin-top-5">\n        <div class="col-xs-5 text-right">\n          <strong translate="PHONE"></strong>\n        </div>\n        <div class="col-xs-7 hover-icon-wrapper">\n          <span class="truncate" ng-bind="user.phone"></span>\n          <i ng-if="!user.phone" class="text-muted font-weight-300" translate="EMPTY"></i>\n        </div>\n      </div>\n      <!-- /Customer phone number -->\n\n      <div class="col-xs-12">\n        <hr/>\n      </div>\n\n      <!-- Customer view -->\n      <div class="col-xs-12 text-left padding-left-0 customer-info margin-top-5">\n        <div class="col-xs-5 text-right">\n          <strong translate="VIEW"></strong>\n        </div>\n        <div class="pointer hover-icon-wrapper" ng-if="!isExpanding" ng-click="toggleExpand()">\n          <span class="truncate col-xs-6 ">{{ room.currentView }}</span>\n          <i class="material-icons md-16 hover-icon">visibility</i>\n        </div>\n\n        <div ng-if="isExpanding" class="col-xs-7">\n          <input autofocus\n            id="room-view"\n            type="text"\n            ng-blur="toggleExpand()"\n            class="form-control input-sm"\n            value="{{ room.currentView }}"\n            readonly>\n        </div>\n      </div>\n      <!-- /Customer view -->\n\n      <section require-kite-web-view="room.currentView">\n        <!-- Customer location -->\n        <div class="col-xs-12 text-left padding-left-0 customer-info margin-top-5">\n          <div class="col-xs-5 text-right">\n            <strong translate="LOCATION"></strong>\n          </div>\n\n          <div class="col-xs-7" ng-bind="user.location.region + \', \' + user.location.country"></div>\n        </div>\n        <!-- /Customer location -->\n\n        <!-- Customer browser -->\n        <div class="col-xs-12 text-left padding-left-0 customer-info margin-top-5">\n          <div class="col-xs-5 text-right">\n            <strong translate="BROWSER"></strong>\n          </div>\n          <div class="col-xs-7" ng-bind="user.browser.name + \' \' + user.browser.build"> </div>\n        </div>\n        <!-- /Customer browser -->\n\n        <!-- Customer OS -->\n        <div class="col-xs-12 text-left padding-left-0 customer-info margin-top-5">\n          <div class="col-xs-5 text-right">\n            <strong translate="OS"></strong>\n          </div>\n          <div class="col-xs-7" ng-bind="user.browser.os"></div>\n        </div>\n        <!-- /Customer OS -->\n      </section>\n\n      <div class="clearfix"></div>\n      <hr/>\n\n    </div>\n\n    <div class="col-md-8 col-md-pull-4 col-xs-12" style="height: 100vh;">\n      <div class="message-wrapper scroller"\n           msg-view="newMsgBin"\n           when-scrolled="loadHistory()">\n        <!-- List all messages -->\n      </div>\n    </div>\n\n  </section>\n</section>\n'),n.put("modules/chat.client.view.html",'<!-- The chat view -->\n<section class="chat-container" ng-controller="ChatController as vm">\n  <tstyle></tstyle>\n  <ng-include src="\'modules/chat/client/views/toolbar.client.view.html\'" prevent-touch-move-ios>\n\n  </ng-include>\n  <div class="chat-control" prevent-touch-move-ios="{\'allow-tmove-child\': true }">\n    <div class="message-wrapper scroller"\n         mobile-class\n         when-scrolled="loadHistory()"\n         on-click-ab-img="vm.onClickImg(title, src)"\n         prevent-touch-move-over-top-ios>\n        <div msg-view="vm.newMsgBin">\n          <!-- List all messages -->\n        </div>\n    </div>\n\n    <!-- <div class="margin-top-5 typing">\n      <i ng-show="vm.isTyping" class="text-muted">{{ vm.senderName }} {{ \'IS_TYPING\' | translate }}</i>\n    </div> -->\n\n    <!-- The message form -->\n    <div class="chat-box-wrap" chat-box-wrap-ios="{ \'text-input-selector\': \'fieldset > div > input\' }"\n      mobile-class>\n      <form class="chat-box" ng-submit="vm.sendMessage();" focus-after-submit=".inner-addon #messageText"\n        name="chatBoxForm">\n        <fieldset>\n          <div class="inner-addon double" emoji-form emoji-message="emojiMessage">\n            <!-- <input type="text"\n                   id="messageText"\n                   name="messageText"\n                   class="form-control chat-text-input"\n                   mobile-class\n                   ng-model="vm.messageText"\n                   placeholder="{{ \'INPUT_MESSAGE_PLACEHOLDER\' | translate }}"\n                   autocomplete="off"\n                   ng-disabled="!vm.chatOK"\n                   ng-keydown="changeChatState(\'composing\')"\n                   prevent-touch-move-ios\n                   autofocus/> -->\n\n            <textarea type="text"\n              ng-enter="vm.sendMessage();"\n              autoheight\n              id="messageText"\n              name="messageText"\n              class="form-control chat-text-input"\n              mobile-class\n              ng-model="vm.messageText"\n              placeholder="{{ \'INPUT_MESSAGE_PLACEHOLDER\' | translate }}"\n              autocomplete="off"\n              ng-disabled="!vm.chatOK"\n              ng-keydown="changeChatState(\'composing\')"\n              prevent-touch-move-ios\n              autofocus>\n            </textarea>\n\n            <span class="right-addon">\n              <div class="inline-block"\n                 href="javascript:;"\n                 ng-click="vm.chatOK && vm.toggleEmoji(); $event.stopPropagation()"\n                 ng-class="{\'disabled-pointer\': !vm.chatOK, \'pointer\': vm.chatOK }"\n                 ng-disabled="!vm.chatOK"\n                 prevent-touch-move-ios>\n                <svg width="24px" height="24px" viewBox="1848 823 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                  <g id="Group" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(1848.000000, 823.000000)">\n                    <path d="M12,0 C5.383125,0 0,5.383125 0,12 C0,18.616875 5.383125,24 12,24 C18.616875,24 24,18.616875 24,12 C24,5.383125 18.616875,0 12,0 L12,0 Z M12,22.5 C6.210375,22.5 1.5,17.789625 1.5,12 C1.5,6.210375 6.210375,1.5 12,1.5 C17.789625,1.5 22.5,6.210375 22.5,12 C22.5,17.789625 17.789625,22.5 12,22.5 L12,22.5 Z" id="Shape" ng-attr-fill="{{vm.colors.background}}"></path>\n                    <ellipse id="Oval" ng-attr-fill="{{vm.colors.background}}" cx="7.69425" cy="8.010375" rx="1.62675" ry="1.62675"></ellipse>\n                    <ellipse id="Oval" ng-attr-fill="{{vm.colors.background}}" cx="16.305" cy="8.010375" rx="1.62675" ry="1.62675"></ellipse>\n                    <path d="M19.702875,13.713 C19.308,13.5945 18.888375,13.820625 18.769875,14.217 C18.75675,14.261625 17.36775,18.697125 12,18.697125 C6.667875,18.697125 5.286,14.397 5.229375,14.214 C5.109375,13.818375 4.689,13.59525 4.297125,13.713 C3.9,13.831875 3.674625,14.25 3.793125,14.646375 C3.81,14.701875 5.52825,20.197125 12,20.197125 C18.47175,20.197125 20.19,14.701875 20.206875,14.646 C20.325375,14.25 20.1,13.831875 19.702875,13.713 L19.702875,13.713 Z" id="Shape" ng-attr-fill="{{vm.colors.background}}"></path>\n                  </g>\n                </svg>\n              </div>\n\n              <emoji-group-menu\n                  ng-model="vm.messageText"\n                  textarea-id="\'messageText\'"\n                  ng-emoji-icons="vm.emojiIcons"\n                  ng-emoji-groups="vm.emojiGroups">\n              </emoji-group-menu>\n\n              <button type="submit" class="send-button margin-right-5" ng-show="vm.messageText.length"\n                ng-style="{\'color\': vm.colors.background }"\n                translate="SEND">\n              </button>\n\n              <label class="inline-block file-upload margin-right-10 margin-left-5"\n                     ng-class="{ \'disabled disabled-pointer\': !vm.chatOK, \'pointer\': vm.chatOK }"\n                     ng-show="!vm.messageText.length"\n                     prevent-touch-move-ios>\n                <svg width="24px" height="24px" viewBox="1819 823 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                  <g id="Group" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(1819.000000, 823.000000)">\n                    <path d="M11.64675,23.29425 C5.2245,23.29425 0,18.069 0,11.64675 C0,5.2245 5.2245,0 11.64675,0 C18.069,0 23.2935,5.2245 23.2935,11.64675 C23.29425,18.069 18.069,23.29425 11.64675,23.29425 L11.64675,23.29425 Z M11.64675,1.3305 C5.958,1.3305 1.3305,5.95875 1.3305,11.64675 C1.3305,17.33475 5.958,21.96225 11.64675,21.96225 C17.33475,21.96225 21.96225,17.33475 21.96225,11.64675 C21.96225,5.95875 17.33475,1.3305 11.64675,1.3305 L11.64675,1.3305 Z" id="Shape" ng-attr-fill="{{vm.colors.background}}"></path>\n                    <path d="M16.239,12.312 L7.0545,12.312 C6.687,12.312 6.3885,12.015 6.3885,11.64675 C6.3885,11.27925 6.68625,10.98075 7.0545,10.98075 L16.239,10.98075 C16.6065,10.98075 16.90425,11.27925 16.90425,11.64675 C16.90425,12.015 16.60725,12.312 16.239,12.312 L16.239,12.312 Z" id="Shape" ng-attr-fill="{{vm.colors.background}}"></path>\n                    <path d="M11.64675,16.90425 C11.27925,16.90425 10.98075,16.6065 10.98075,16.239 L10.98075,7.0545 C10.98075,6.687 11.27925,6.3885 11.64675,6.3885 C12.01425,6.3885 12.312,6.687 12.312,7.0545 L12.312,16.239 C12.312,16.60725 12.015,16.90425 11.64675,16.90425 L11.64675,16.90425 Z" id="Shape" ng-attr-fill="{{vm.colors.background}}"></path>\n                  </g>\n                </svg>\n                <input type="file"\n                       file-change="vm.uploadFile"\n                       ng-disabled="!vm.chatOK">\n              </label>\n            </span>\n\n          </div>\n        </fieldset>\n      </form>\n    </div>\n  </div>\n\n</section>\n<audio id="audioRemote"></audio>\n<audio id="audioLocal" muted></audio>\n\n<script type="text/template" id="upload-fail-template">\n  <span class="text-danger">Upload file unsuccessfully</span>\n</script>\n'),n.put("modules/emoji.client.view.html",'<div class="emoji-menu">\n  <div class="emoji-groups" ng-show="isShowMenu">\n    <div class="emoji-groups-header">\n      <a class="emoji-groups-tab" ng-repeat="group in emojiGroups" ng-click="activeGroup(group)" ng-class="{active: group.active}">\n        <span class="emoji-outer emoji-sizer"><span class="emoji-inner" style="background: url(/modules/chat/client/img/emoji_apple.png);background-position:{{ emojiIcons[group.emoji ]}};background-size:3000%"></span></span>\n      </a>\n    </div>\n\n    <div class="emoji-groups-body scroller" prevent-touch-move-over-top-ios mobile-class>\n      <ul ng-repeat="group in emojiGroups" ng-show="group.active">\n        <li ng-repeat="emoji in group.emojis" ng-click="selectEmoji(emoji)">\n          <span class="emoji-outer emoji-sizer"><span class="emoji-inner" style="background: url(/modules/chat/client/img/emoji_apple.png);background-position:{{ emojiIcons[emoji.split(\' \')[0]] }};background-size:3000%">{{emoji}}</span></span>\n        </li>\n      </ul>\n    </div>\n\n    <div class="emoji-groups-footer">\n      <span ng-bind="hoverEmoji"></span>\n    </div>\n  </div>\n</div>\n'),n.put("modules/home.client.view.html",'<section ng-controller="HomeController">\n  <tstyle></tstyle>\n\n  <div class="jumbotron text-center" ng-if="!isWaiting">\n    <div class="head-chat theme-color-bg">\n      <span class="welcom-message col-xs-12 theme-color-text" ng-bind="welcomeMessage"></span>\n      <a href="javascript:;" style-on-hover="{\'background-color\': (colors.background | colorLuminace: -0.15)}" ng-click="hideAppChat()">\n        <!-- <img src="modules/chat/client/img/background/close_icon.svg" alt="Hide app"/> -->\n        <svg class="text-middle minimize-icon" xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 2048 2048">\n          <path d="M1523 864q0 13-10 23l-466 466q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l393 393 393-393q10-10 23-10t23 10l50 50q10 10 10 23z" stroke="none" ng-attr-fill="{{ colors.text }}" fill-rule="evenodd"></path>\n        </svg>\n      </a>\n    </div>\n\n    <div class="chat-kite-form scroller"\n      mobile-class\n      prevent-touch-move-over-top-ios>\n      <form name="infoForm"\n            class="text-left"\n            prevent-touch-move-ios="{\'allow-tmove-child\': true }"\n            ng-submit="startAsking()">\n\n        <label ng-if="!isInWork"\n          class="label-chat margin-top-15"\n          translate="LABEL_NOT_WORKING_HOUR">\n        </label>\n\n        <div class="input-information margin-top-15">\n          <div class="flex">\n            <!-- Gender input -->\n            <gender-input name="gender" ng-model="customer.gender"></gender-input>\n            <!-- Gender input -->\n\n            <!-- Name input -->\n            <div class="margin-bottom-3 margin-left-7 form-group __name has-feedback"\n            name-validation-feedback="{\'input-name\': \'name\'}">\n\n              <input type="text"\n                name="name"\n                class="form-control theme-color-border-left"\n                id="customerName"\n                placeholder="{{ \'INPUT_NAME_PLACEHOLDER\' | translate }}"\n                ng-model="customer.name"\n                ng-required="inputFields.name.required && (!inputFields.name.alt || !customer[inputFields.name.alt].length)"\n                remove-forcus\n                autofocus/>\n            </div>\n            <!-- /Name input -->\n          </div>\n\n          <!-- Email input -->\n          <div class="form-group has-feedback margin-bottom-3"\n              email-validation-feedback="{\'input-name\': \'email\'}">\n\n            <input type="email"\n                   name="email"\n                   class="form-control theme-color-border-left"\n                   id="customerEmail"\n                   placeholder="{{ \'INPUT_EMAIL_PLACEHOLDER\' | translate }}"\n                   ng-model="customer.email"\n                   ng-required="inputFields.email.required && (!inputFields.email.alt || !customer[inputFields.email.alt].length)"\n                   remove-forcus\n                   ng-model-options="{ debounce: 250 }"\n                   pattern="[^@]+@[^@]+\\.[a-zA-Z]{2,}">\n          </div>\n          <!-- /Email input -->\n\n          <!-- Phone input -->\n          <div class="form-group has-feedback margin-bottom-3"\n              phone-validation-feedback="{\'input-name\': \'phone\'}">\n\n            <input type="phone"\n                   name="phone"\n                   class="form-control theme-color-border-left"\n                   id="customerPhone"\n                   placeholder="{{ \'INPUT_PHONE_PLACEHOLDER\' | translate }}"\n                   ng-model="customer.phone"\n                   ng-required="inputFields.phone.required && (!inputFields.phone.alt || !customer[inputFields.phone.alt].length)"\n                   remove-forcus\n                   pattern="^0\\d{9,10}$|^1[8-9]00\\d{4,6}$|^\\+?1\\d{10}$|^\\+[2-9]\\d{7,}$"\n                   ng-model-options="{ debounce: 250 }">\n          </div>\n          <!-- /Phone input -->\n\n          <!-- CO AppId -->\n          <div class="form-group has-feedback"\n            ng-if="supportRooms.length>1"\n            ng-class="{ \'has-success\': infoForm.supportRoom.$valid }">\n\n            <!-- Not group support rooms -->\n            <select class="form-control theme-color-border-left" ng-model="input.selectedRoom" ng-change="onSelectedSupportRoom()"\n              ng-options="room as room.original_data.name for room in supportRooms track by room.original_data.appId"\n              ng-class="{ \'text-muted\': !infoForm.supportRoom.$valid }"\n              ng-if="!supportRooms[0].extra_data"\n              name="supportRoom"\n              required>\n\n              <option value="" disabled translate="INPUT_COAPPID_PLACEHOLDER"></option>\n            </select>\n            <!-- /Not group support rooms -->\n\n            <!-- Group support rooms -->\n            <select class="form-control theme-color-border-left" ng-model="input.selectedRoom" ng-change="onSelectedSupportRoom()"\n              name="supportRoom"\n              ng-options="room as room.extra_data.name group by room.extra_data.group for room in supportRooms | orderBy:[\'-extra_data.group\', \'-extra_data.name\'] track by room.original_data.appId"\n              ng-class="{ \'text-muted\': !infoForm.supportRoom.$valid }"\n              ng-if="supportRooms[0].extra_data"\n              required>\n\n              <option value="" disabled translate="INPUT_COAPPID_PLACEHOLDER"></option>\n            </select>\n            <!-- /Group support rooms -->\n\n            <!-- Icon feedback -->\n            <i class="material-icons form-control-feedback margin-right-10"\n              ng-show="infoForm.supportRoom.$valid">check</i>\n            <!-- /Icon feedback -->\n\n          </div>\n          <!-- /CO AppId -->\n          <div class="form-group margin-bottom-10">\n            <!-- Default label -->\n            <!-- <label class="label-chat margin-top-5"\n              ng-if="!labelFormQuestion"\n              for="customerFirstQuestion">\n              <span translate="LABEL_FORM_QUESTION"></span> <i class="fa fa-asterisk md-12 text-top"></i>\n            </label> -->\n            <!-- /Default label -->\n\n            <!-- Custom label -->\n            <!-- <label class="label-chat margin-top-5"\n              ng-if="labelFormQuestion"\n              for="customerFirstQuestion">\n              <span ng-bind="labelFormQuestion"></span> <i class="fa fa-asterisk md-12 text-top"></i>\n            </label> -->\n            <!-- /Custom label -->\n\n            <textarea type="text"\n                  name="question"\n                  class="form-control input-question"\n                  mobile-class\n                  rows="2"\n                  id="customerFirstQuestion"\n                  placeholder="{{ \'* \' + ( (isInWork ? \'INPUT_QUESTION_PLACEHOLDER\' : \'INPUT_LEAVING_MESSAGE_PLACEHOLDER\') | translate) }}"\n                  ng-model="customer.question"\n                  required\n                  autofocus\n                  ng-style="supportRooms.length < 2 && !bowser.mobile && {\'height\': \'168px\'}"\n                  ng-change="onChangeQuestion()">\n            </textarea>\n          </div>\n\n          <span class="small"><i class="fa fa-asterisk"></i> <span translate="FIELD_REQUIRE_INPUT_NOTE"></span></span>\n        </div>\n\n        <div class="form-group kite-submit-button"\n          mobile-class>\n          <button type="submit" class="btn btn-block theme-color-bg theme-color-text"\n            ng-if="isInWork"\n            translate="START_ASKING" ng-disabled="!infoForm.$valid">\n          </button>\n\n          <button type="submit" class="btn btn-block theme-color-bg theme-color-text"\n            ng-if="!isInWork"\n            translate="SEND_MESSAGE" ng-disabled="!infoForm.$valid">\n          </button>\n\n          <p class="help-block text-danger margin-top-10"\n             ng-if="errorCode"\n             translate="{{ errorCode }}">\n          </p>\n        </div>\n      </form>\n    </div>\n\n    <section class="chat-footer"\n      mobile-class\n      ng-include="\'modules/core/client/views/powered.client.view.html\'">\n    </section>\n  </div>\n\n  <div class="text-center waiting"\n       ng-show="isWaiting"\n       ng-class="{\'flash animated\': isWaiting}"\n       translate="PLEASE_WAIT">\n  </div>\n</section>\n'),n.put("modules/participant.client.views.html",'<div class="participant col-sm-6 col-md-4 col-lg-3 text-center">\n  <div class="participant-wrapper">\n    <div class="avatar" style="background-image:url(\'data:image/png;base64,{{ info.icon }}\')"></div>\n\n    <label ng-bind="info.name"></label>\n    <label ng-if="info.isMe && info.name!==\'You\'"> (You)</label>\n    <div class="control-wrapper">\n      <div class="control-buttons btn-group" role="group">\n        <button type="button" class="btn btn-transparent" ng-click="openProfileDialog()" ng-if="info.isMe">\n          <i class="fa fa-user"></i>\n        </button>\n        <button type="button" class="btn btn-transparent" ng-click="openKickDialog()" ng-if="isOwner && !info.isMe">\n          <i class="fa fa-close"></i>\n        </button>\n      </div>      \n    </div>\n  </div>\n<div>'),n.put("modules/rating.client.view.html",'<div class="hearth-rating pointer" ng-click="openModalRating()" ng-if="displayRatingBtn">\n  <a class="text-middle"\n    href="javascript:;">\n    <i class="material-icons">thumb_up</i>\n  </a>\n</div>\n'),n.put("modules/room.client.view.html",'<section class="row">\n  <section ng-class="{forceShow: showParticipant}"\n    class="chat-view"\n    ng-include="\'/modules/chat/client/views/chat.client.view.html\'">\n  </section>\n\n  <section class="chat-footer margin-bottom-3"\n          ng-controller="ToolbarController as vm"\n          ng-include="\'/modules/core/client/views/chat-powered.client.view.html\'"\n          mobile-class\n          prevent-touch-move-ios>\n\n  </section>\n</section>\n'),n.put("modules/sendingTranscript.client.view.html",'<a class="text-left"\n   href="javascript:;"\n   ng-if="!config.enable"\n   translate="SETTING_SEND_EMAIL"\n   popover-trigger="outsideClick"\n   popover-is-open="popoverConfig.isOpen"\n   popover-placement="top-left"\n   uib-popover-template="\'modules/chat/client/views/modals/sendingTranscriptConfig.client.view.html\'">\n</a>\n\n<a class="text-left"\n   href="javascript:;"\n   ng-if="config.enable"\n   translate="CANCEL_SETTING_SEND_EMAIL"\n   ng-click="cancelSendingTranscript()">\n</a>\n'),n.put("modules/toolbar.client.view.html",'<div class="toolbar" ng-controller="ToolbarController as vm"\n     ng-style="{\'background-color\': vm.colors.background }">\n  <strong class="pull-left padding-left-10 hello-message" ng-bind="vm.helloMessage"\n       ng-style="{ color: vm.colors.text }">\n  </strong>\n  <div class="pull-right hide-chat padding-right-5 pointer" ng-click="vm.hideAppChat()" title="{{ \'HIDE\' | translate }}">\n    <a href="javascript:;">\n      <svg class="text-middle" xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 2048 2048"\n           style-on-hover="{\'background-color\': (vm.colors.background | colorLuminace: -0.15), \'border-radius\': \'6px\' }">\n        <path d="M1523 864q0 13-10 23l-466 466q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l393 393 393-393q10-10 23-10t23 10l50 50q10 10 10 23z" stroke="none" ng-attr-fill="{{ vm.colors.text }}" fill-rule="evenodd"></path>\n      </svg>\n    </a>\n  </div>\n\n  <div class="pull-right hide-chat padding-right-5 padding-left-10">\n    <rating></rating>\n  </div>\n</div>\n'),n.put("modules/modals/rating.client.view.html",'<div class="modal-body rating-body">\n  <h6 class="padding-bottom-10 header-rating" translate="SUPPORTER_RATING"></h6>\n  <form name="ratingForm"\n    ng-submit="ok()">\n    <div class="form-group margin-bottom-0">\n      <textarea ng-model="rating.comment" class="form-control"\n      placeholder="{{\'RATING_COMMENT\' | translate}}"\n      rows="2" cols="50"></textarea>\n    </div>\n\n    <div class="margin-bottom-10 margin-top-5 pointer">\n      <i uib-rating ng-model="rating.rate" max="5" ng-style="{\'color\': \'#fcd31a\',\'font-size\':\'21px\',\'outline\':\'none\'}" state-on="\'fa fa-star\'" state-off="\'fa fa-star-o\'"></i>\n    </div>\n\n    <div class="form-group">\n      <span class="skip-step pointer md-14 margin-right-15" type="button" ng-click="cancel()" translate="SKIP_THIS_STEP"></span>\n      <button class="btn theme-color-bg theme-color-text" ng-disabled="ratingForm.$pristine" type="submit" translate="SUBMIT"></button>\n    </div>\n  </form>\n\n</div>\n'),n.put("modules/modals/sendingTranscriptConfig.client.view.html",'<form>\n  <div class="form-group margin-0 padding-bottom-15">\n    <input type="email" class="form-control" ng-model="config.email" placeholder="Input email">\n  </div>\n  <button class="btn btn-success" type="button" ng-click="okConfig()" translate="OK"></button>\n  <button class="btn btn-default" type="button" ng-click="cancelConfig()" translate="CANCEL"></button>\n</form>\n'),n.put("modules/templates/busy-message.client.view.html",'<div class="media">\n  <div class="media-left pull-left">\n    <a href="#">\n      <img width="40" src="modules/chat/client/img/kite.svg" class="pull-left chat-profile-image" />\n    </a>\n  </div>\n\n  <div class="media-body chat-message-details pull-left">\n    <span ng-bind-html="::(message.body | formatMessage | html)">\n    </span>\n\n    <form class="chat-box margin-top-10"\n      name="infoForm"\n      ng-submit="submit(); infoForm.$setPristine()"\n      ng-if="isBusy">\n      <div class="form-group has-feedback"\n        ng-class="{ \'has-success\': infoForm.name.$viewValue.length }">\n\n        <input type="text" name="name"\n          class="form-control chat-text-input"\n          placeholder="{{ \'INPUT_NAME_PLACEHOLDER\' | translate }}"\n          ng-model="input.name"\n          ng-disabled="isUpdating">\n\n        <i class="material-icons form-control-feedback"\n          ng-show="infoForm.name.$viewValue.length">check</i>\n      </div>\n\n      <div class="form-group has-feedback"\n        ng-class="{ \'has-error\': !infoForm.email.$valid && infoForm.email.$viewValue.length,\n              \'has-success\': infoForm.email.$valid && infoForm.email.$viewValue.length }">\n\n        <input type="email"\n          name="email"\n          class="form-control chat-text-input"\n          placeholder="{{ \'INPUT_EMAIL_PLACEHOLDER\' | translate }}"\n          ng-model="input.email"\n          ng-disabled="isUpdating">\n\n        <i class="material-icons form-control-feedback"\n          ng-show="!infoForm.email.$valid && infoForm.email.$viewValue.length">error_outline</i>\n\n        <i class="material-icons form-control-feedback"\n          ng-show="infoForm.email.$valid && infoForm.email.$viewValue.length">check</i>\n      </div>\n\n      <div class="form-group has-feedback"\n        ng-class="{ \'has-error\': !infoForm.phone.$valid && infoForm.phone.$viewValue.length,\n           \'has-success\': infoForm.phone.$valid && infoForm.phone.$viewValue.length }">\n        <input type="phone" name="phone"\n          class="form-control chat-text-input"\n          placeholder="{{ \'INPUT_PHONE_PLACEHOLDER\' | translate }}"\n          ng-model="input.phone"\n          pattern="^0\\d{9,10}$|^1[8-9]00\\d{4,6}$|^\\+?1\\d{10}$|^\\+[2-9]\\d{7,}$"\n          ng-disabled="isUpdating">\n\n        <i class="material-icons form-control-feedback"\n          ng-show="!infoForm.phone.$valid && infoForm.phone.$viewValue.length">error_outline</i>\n\n        <i class="material-icons form-control-feedback"\n          ng-show="infoForm.phone.$valid && infoForm.phone.$viewValue.length">check</i>\n      </div>\n\n      <span class="pull-left text-success"\n        ng-if="showSuccessText">\n        <span translate="UPDATE_SUCCESS"></span>!\n      </span>\n\n      <div class="form-group text-right">\n        <button class="btn"\n          type="submit"\n          ng-style="{\'background-color\': colors.background, \'color\': colors.text}"\n          ng-disabled="infoForm.$pristine || !infoForm.$valid || isUpdating || (!input.email.length && !input.phone.length)">\n          <span translate="UPDATE"></span>!\n        </button>\n      </div>\n    </form>\n  </div>\n</div>\n'),n.put("modules/templates/chat-input.client.view.html",'<form class="chat-box">\n  <fieldset>\n    <div class="inner-addon double" emoji-form emoji-message="emojiMessage">\n      <textarea class="form-control chat-text-input"\n                mobile-class\n                placeholder="::{{ \'INPUT_MESSAGE_PLACEHOLDER\' | translate }}"\n                autocomplete="off"\n                >\n\n      </textarea>\n      <input type="text"\n             id="messageText"\n             name="messageText"\n             class="form-control chat-text-input"\n             mobile-class\n             ng-model="vm.messageText"\n             placeholder="{{ \'INPUT_MESSAGE_PLACEHOLDER\' | translate }}"\n             autocomplete="off"\n             ng-disabled="!vm.chatOK"\n             ng-keydown="changeChatState(\'composing\')"\n             autofocus/>\n      <span class="right-addon">\n        <label class="inline-block file-upload"\n               ng-class="{ \'disabled disabled-pointer\': !vm.chatOK, \'pointer\': vm.chatOK }">\n          <img src="modules/chat/client/img/add_file.svg"></img>\n          <input type="file"\n                 file-change="vm.uploadFile"\n                 ng-disabled="!vm.chatOK">\n        </label>\n        <!-- <div class="inline-block pointer padding-top-7 padding-bottom-7" >\n\n\n        </div> -->\n        <emoji-group-menu\n            ng-model="vm.messageText"\n            textarea-id="\'messageText\'"\n            ng-emoji-icons="vm.emojiIcons"\n            ng-emoji-groups="vm.emojiGroups">\n        </emoji-group-menu>\n        <div class="inline-block"\n           href="javascript:;"\n           ng-click="vm.chatOK && vm.toggleEmoji(); $event.stopPropagation()"\n           ng-class="{\'disabled-pointer\': !vm.chatOK, \'pointer\': vm.chatOK, \'margin-right-5\': !vm.bowser.mobile, \'margin-right-15\': vm.bowser.mobile}"\n           ng-disabled="!vm.chatOK">\n          <img src="modules/chat/client/img/smile_icon.svg"></img>\n        </div>\n        <!-- <button type="submit" class="btn btn-success" ng-disabled="!vm.messageText.length">Send</button> -->\n      </span>\n\n    </div>\n  </fieldset>\n</form>\n'),n.put("modules/templates/email-validation-feedback.view.html",'<!-- Icon feedback -->\n<i class="material-icons form-control-feedback"\n  ng-show="hasError && !hideIconFeedback">error_outline</i>\n\n<i class="material-icons form-control-feedback"\n  ng-show="hasSuccess && !hideIconFeedback">check</i>\n\n<!-- \n<i class="fa fa-asterisk text-muted form-control-feedback"\n  ng-show="hasRequire2Input && !hideIconFeedback"></i>\n   -->\n<!-- /Icon feedback -->\n\n<!-- Text feedback -->\n<small class="text-danger text-feedback">\n  <span ng-show="hasRequire2Input && inputModelCtrl.firstShow" translate="ERROR.EMAIL_MISSING"></span>\n  <span ng-show="hasError && hasOneAt(inputModelCtrl.$viewValue)" translate="ERROR.EMAIL_INVALID"></span>\n  <span ng-show="hasError && !hasOneAt(inputModelCtrl.$viewValue)" translate="ERROR.EMAIL_MISSING_AT"></span>\n  &nbsp;\n</small>\n<!-- /Text feedback -->\n'),
n.put("modules/templates/file-message.client.view.html",'<div ng-if="message.file"\n     class="attachment-box"\n     title="{{ message.created | date:\'mediumTime\' }}">\n  <div ng-if="message.file.uploading !== 100"\n       class="count-down">\n    {{ message.file.uploading }}%\n  </div>\n\n  <img ng-if="message.file.thumbnailUrl && message.file.uploading !== 100"\n       ng-class="{ \'uploading\': message.file.uploading !== 100 }"\n       ng-src="{{ message.file.thumbnailUrl }}"/>\n\n  <!-- previous: false; next: false; -->\n  <a ng-if="message.file.thumbnailUrl && message.file.uploading === 100 && !message.noLightBox"\n     href="{{ message.file.fileUrl }}"\n     data-lightbox="previous: false; next: false; {{ message.file.thumbnailUrl }}"\n     data-title="{{ message.file.name }}">\n\n    <img ng-class="{ \'uploading\': message.file.uploading !== 100 }"\n         ng-src="{{ message.file.thumbnailUrl }}"\n         alt="{{ message.file.name }}"/>\n  </a>\n\n  <a ng-if="message.file.thumbnailUrl && message.file.uploading === 100 && message.noLightBox"\n     href="javascript:;">\n    <img ng-class="{ \'uploading\': message.file.uploading !== 100 }"\n         ng-src="{{ message.file.thumbnailUrl }}"\n         alt="{{ message.file.name }}"/>\n  </a>\n\n  <div ng-if="!message.file.thumbnailUrl"\n       class="media"\n       ng-class="{ \'uploading\': message.file.uploading !== 100 }">\n    <div class="media-left">\n      <i class="fa fa-paperclip"></i>\n    </div>\n    <div class="media-body">\n      <a ng-if="message.file.uploading == 100"\n      href="{{ message.file.fileUrl }}"\n      target="_blank">{{ message.file.name }}</a>\n      <span ng-if="message.file.uploading !== 100">{{ message.file.name }}</span>\n    </div>\n  </div>\n</div>\n'),n.put("modules/templates/gender-input.client.view.html",'<div class="inline-block">\n  <div class="flex" data-toggle="buttons">\n    <label class="btn btn-radio btn-md theme-color-border"\n      ng-repeat="gender in genderOptions track by gender.val"\n      ng-class="{ \'margin-left-5\': $index }"\n      ng-model="input.val"\n      ng-change="updateModel(input.val)"\n      uib-btn-radio="\'{{gender.val}}\'">\n\n      <input type="radio" name="gender" ng-required="!input.val">\n      <strong translate="{{gender.translate}}"></strong>\n    </label>\n  </div>\n</div>\n'),n.put("modules/templates/message.client.view.html",'<div>\n  <row-date ng-model="message" ng-if="::(message.isNewDate)"></row-date>\n</div>\n\n<div class="chat-message"\n     ng-class="::{ \'me\': message.isMe }"\n     id="{{ ::message.id }}">\n\n  <system-message ng-model="message"\n    ng-if="::(message.system && !message.subtype)">\n  </system-message>\n\n  <busy-message ng-model="message"\n    ng-if="::(message.system && message.subtype === \'busy\')">\n  </busy-message>\n\n  <div class="media" ng-if="!message.system">\n    <div class="sender"\n         ng-if="message.name!==\'\' && message.showName"\n         ng-class="::{ \'me\': message.isMe }"\n         ng-bind="message.name">\n    </div>\n    <div class="media-left pull-left" ng-if="!message.isMe" >\n      <a href="#">\n        <img width="40" ng-src="{{message.icon}}" alt="{{message.username}}" class="pull-left chat-profile-image" />\n      </a>\n    </div>\n\n    <div class="media-body chat-message-details"\n         ng-class="::{\'pull-right\': message.isMe, \'pull-left\': !message.isMe}"\n         ng-style="::(message.isMe && {\'background-color\': colors.background, \'color\': colors.text})">\n\n      <span ng-if="!message.file"\n            ng-bind-html="::(message.body | formatMessage | html)"\n            title="{{ message.created | date:\'mediumTime\' }}">\n      </span>\n\n      <file-message ng-if="message.file" ng-model="message">\n      </file-message>\n    </div>\n\n    <span class="message-time text-muted padding-top-10"\n          ng-class="::{\'pull-right padding-right-5\': message.isMe, \'pull-left\': !message.isMe}">\n      {{ ::moment(message.created).format(\'H:mm\') }}\n    </span>\n    <!-- <div class="media-right" ng-if="message.isMe">\n      <a href="#">\n        <img width="32" ng-src="{{message.icon}}" alt="{{message.username}}" class="pull-left chat-profile-image" />\n      </a>\n    </div> -->\n  </div>\n</div>\n'),n.put("modules/templates/name-validation-feedback.view.html",'<!-- Icon feedback -->\n <i class="material-icons form-control-feedback"\n   ng-show="hasSuccess && !hideIconFeedback">check</i>\n\n<!-- \n <i class="fa fa-asterisk text-muted form-control-feedback"\n   ng-show="hasRequire2Input && !hideIconFeedback"></i>\n    -->\n <!-- /Icon feedback -->\n\n <!-- Text feedback -->\n <small class="text-danger text-feedback">\n   <span ng-show="hasRequire2Input && inputModelCtrl.firstShow" translate="ERROR.NAME_MISSING"></span>\n   &nbsp;\n </small>\n <!-- /Text feedback -->\n'),n.put("modules/templates/phone-validation-feedback.view.html",'<!-- Icon feedback -->\n<i class="material-icons form-control-feedback"\n  ng-show="hasError && !hideIconFeedback">error_outline</i>\n\n<i class="material-icons form-control-feedback"\n  ng-show="hasSuccess && !hideIconFeedback">check</i>\n\n<!--\n<i class="fa fa-asterisk text-muted form-control-feedback"\n  ng-show="hasRequire2Input && !hideIconFeedback"></i>\n   -->\n<!-- /Icon feedback -->\n\n<!-- Text feedback -->\n<small class="text-danger text-feedback">\n  <span ng-show="hasRequire2Input && inputModelCtrl.firstShow" translate="ERROR.PHONE_MISSING"></span>\n  <span ng-show="hasError && !isOnlyNumber(inputModelCtrl.$viewValue)" translate="ERROR.PHONE_INVALID"></span>\n  <span ng-show="hasError && inputModelCtrl.$viewValue.length<10 && isOnlyNumber(inputModelCtrl.$viewValue)" translate="ERROR.PHONE_LENGTH"></span>\n  <span ng-show="hasError && inputModelCtrl.$viewValue.length>=10 && isOnlyNumber(inputModelCtrl.$viewValue)" translate="ERROR.PHONE_INVALID_2"></span>\n  &nbsp;\n</small>\n<!-- /Text feedback -->\n'),n.put("modules/templates/row-date.client.view.html",'<div class="row-date">\n  <span class="date-value">\n    {{ ::formatedDate }}\n  </span>\n</div>\n'),n.put("modules/templates/system-message.client.view.html",'<div class="media">\n  <div class="media-left pull-left">\n    <a href="#">\n      <img width="40" src="modules/chat/client/img/kite.svg" class="pull-left chat-profile-image" />\n    </a>\n  </div>\n\n  <div class="media-body chat-message-details pull-left">\n    <span ng-bind-html="::(message.body | formatMessage | html)">\n    </span>\n  </div>\n</div>\n'),n.put("modules/templates/tstyle.client.view.html",'<style type="text/css">\n  .theme-color-bg {\n    background-color: {{ colors.background }};\n  }\n  .theme-color-text,\n  .theme-color-text:hover {\n    color: {{ colors.text }};\n  }\n  .theme-color-border {\n    border-color: {{ colors.background }};\n  }\n</style>\n<style type="text/css" ng-if="themeName==\'datviet\'">\n  .theme-color-border-left {\n    border-left-color: {{ colors.background }} !important;\n  }\n</style>\n')}angular.module("chat").run(n),n.$inject=["$templateCache"]}();
